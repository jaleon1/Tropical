var selector="#txt_pago";function sendVal(a){switch(localStorage.setItem("lsTarjetaCredito","0.00"),localStorage.setItem("lsEfectivo",document.getElementById("txt_pagoCash").value),localStorage.setItem("lsVuelto",document.getElementById("vuelto").innerHTML.substr(11)),localStorage.setItem("lsDif","0.00"),a){case a>=0&&a<=9?a:-1:addNumber(a);break;case"enter":enter();break;case"left":left();break;default:return!1}}function sendRef(a){switch(localStorage.setItem("lsTarjetaCredito",document.getElementById("total_pagar").innerHTML.substr(16)),localStorage.setItem("lsEfectivo","0.00"),localStorage.setItem("lsVuelto","0.00"),localStorage.setItem("lsDif","0.00"),a){case a>=0&&a<=9?a:-1:addRef(a);break;case"enter":enter();break;case"left":leftRef();break;default:return!1}}function addNumber(a){$(".valPago").val($(".valPago").val()+a),validarMonto()}function addRef(a){$(".valRef").val($(".valRef").val()+a),validarRef()}function left(){precio=$(".valPago").val(),$(".valPago").val(precio.substring(0,precio.length-1)),validarMonto()}function leftRef(){precio=$(".valRef").val(),$(".valRef").val(precio.substring(0,precio.length-1)),validarRef()}function validarMonto(){if(totalXPagar=parseFloat($("#total")[0].textContent.replace("¢","")),$(".valPago").val()>=totalXPagar){document.getElementById("vuelto").style.color="#FF0000",document.getElementById("vuelto").textContent="Su vuelto: "+(-1*totalXPagar+parseFloat($(".valPago").val())).toString();var element=document.getElementsByClassName("Nosend")[0];element.classList.add("green","letter","send"),element.classList.remove("Nosend")}else{var element2;if(document.getElementById("vuelto").style.color="#73879C",document.getElementById("vuelto").textContent="Su vuelto: ",document.getElementsByClassName("send")[0])document.getElementsByClassName("send")[0].classList.remove("letter","send","green")}}function validarRef(){if($(".valRef")[0].value.length>=5){var element=document.getElementsByClassName("Nosend")[0];element.classList.add("green","letter","send"),element.classList.remove("Nosend")}else if(document.getElementsByClassName("send")[0]){var element2=document.getElementsByClassName("send")[0];element2.classList.add("Nosend"),element2.classList.remove("letter","send","green")}}function enter(){facturar()}function crearFactura(){var miAccion="Create",facVenta=new Object;facVenta.totalVenta=0,$(t.rows().data()).each(function(i,item){switch(item[0]){case 0:facVenta.totalVenta=facVenta.totalVenta+parseFloat(precioMediano);break;case 1:facVenta.totalVenta=facVenta.totalVenta+parseFloat(precioGrande)}$.ajax({type:"POST",url:"class/Factura.php",data:{action:"Create",obj:JSON.stringify(facVenta)}}).done(function(e){var facUUID;crearDetalle("3b31b046-75eb-11e8-abed-f2f00eda2018")}).fail(function(e){distr.showError(e)})})}function crearDetalle(facUUID){var miAccion="Create",prdVenta=new Object;prdVenta.idFactura=facUUID,$(t.rows().data()).each(function(i,item){switch(item[0]){case 0:prdVenta.totalVenta=parseFloat(precioMediano);break;case 1:prdVenta.totalVenta=parseFloat(precioGrande)}prdVenta.numeroLinea=i,prdVenta.detalle=`${item[1]}, ${item[3]}, ${item[5]}, ${item[7]}`,$.ajax({type:"POST",url:"class/ProductoXFactura.php",data:{action:"Create",obj:JSON.stringify(prdVenta)}}).done(function(e){var facUUID;crearOrden("3b31b046-75eb-11e8-abed-f2f00eda2018")}).fail(function(e){distr.showError(e)})})}function crearOrden(facUUID){var miAccion="Create",newOrden=new Object;newOrden.idFactura=facUUID,$(t.rows().data()).each(function(i,item){newOrden.idTamano=item[0],newOrden.idSabor1=item[2],newOrden.idSabor2=item[4],newOrden.idTopping=item[6],$.ajax({type:"POST",url:"class/OrdenXFactura.php",data:{action:"Create",obj:JSON.stringify(newOrden)}}).done(function(e){swal({type:"success",text:"Número de orden de Distribución:",showConfirmButton:!0})}).fail(function(e){distr.showError(e)}).always(function(){location.reload()})})}function facturar(){$("#keyboard li").css("pointer-events","none");var element=document.getElementsByClassName("send")[0];element.classList.add("green","letter","Nosend"),element.classList.remove("send");var miAccion="Create";facturaCli.totalVenta=0,facturaCli.totalDescuentos=0,facturaCli.totalVentaneta=0,facturaCli.totalImpuesto=0,facturaCli.totalComprobante=0,facturaCli.montoEfectivo=0,facturaCli.montoTarjeta=0,facturaCli.detalleFactura=[],facturaCli.detalleOrden=[],$(t.rows().data()).each(function(i,item){var precioUnitario,idPrecio;switch(item[0]){case 0:precioUnitario=parseFloat((precioMediano.precio/1.13).toFixed(5)),idPrecio=precioMediano.id;break;case 1:precioUnitario=parseFloat((precioGrande.precio/1.13).toFixed(5)),idPrecio=precioGrande.id}var objetoDetalleFactura=new Object;objetoDetalleFactura.idPrecio=idPrecio,objetoDetalleFactura.numeroLinea=i+1,objetoDetalleFactura.idTipoCodigo=1,objetoDetalleFactura.codigo=item[1],objetoDetalleFactura.cantidad=1,objetoDetalleFactura.idUnidadMedida=78,objetoDetalleFactura.detalle=`${item[1]}, ${item[3]}, ${item[5]}, ${item[7]}`,objetoDetalleFactura.precioUnitario=precioUnitario,objetoDetalleFactura.montoTotal=parseFloat((objetoDetalleFactura.precioUnitario*objetoDetalleFactura.cantidad).toFixed(5)),objetoDetalleFactura.montoDescuento=0,objetoDetalleFactura.naturalezaDescuento="No aplican descuentos",objetoDetalleFactura.subTotal=parseFloat((objetoDetalleFactura.montoTotal-objetoDetalleFactura.montoDescuento).toFixed(5)),objetoDetalleFactura.codigoImpuesto=1,objetoDetalleFactura.tarifaImpuesto=13,objetoDetalleFactura.montoImpuesto=parseFloat((objetoDetalleFactura.subTotal*(objetoDetalleFactura.tarifaImpuesto/100)).toFixed(5)),objetoDetalleFactura.montoTotalLinea=parseFloat((objetoDetalleFactura.subTotal+objetoDetalleFactura.montoImpuesto).toFixed(5)),facturaCli.detalleFactura.push(objetoDetalleFactura),facturaCli.totalVenta=parseFloat((facturaCli.totalVenta+objetoDetalleFactura.montoTotal).toFixed(5)),facturaCli.totalDescuentos=parseFloat((facturaCli.totalDescuentos+objetoDetalleFactura.montoDescuento).toFixed(5)),facturaCli.totalImpuesto=parseFloat((facturaCli.totalImpuesto+objetoDetalleFactura.montoImpuesto).toFixed(5));var objetoDetalleOrden=new Object;objetoDetalleOrden.idTamano=item[0],objetoDetalleOrden.idSabor1=item[2],objetoDetalleOrden.idSabor2=item[4],objetoDetalleOrden.idTopping=item[6],facturaCli.detalleOrden.push(objetoDetalleOrden)}),null==$("#txt_pagoCash").val()?facturaCli.montoEfectivo="0":facturaCli.montoEfectivo=$("#txt_pagoCash").val(),null==$("#total_pagar").text()?facturaCli.montoTarjeta="0":facturaCli.montoTarjeta=$("#total_pagar").text().substring(16),facturaCli.totalServGravados=0,facturaCli.totalServExentos=0,facturaCli.totalMercanciasGravadas=facturaCli.totalVenta,facturaCli.totalMercanciasExentas=0,facturaCli.totalGravado=parseFloat((facturaCli.totalServGravados+facturaCli.totalMercanciasGravadas).toFixed(5)),facturaCli.totalExento=parseFloat((facturaCli.totalServExentos+facturaCli.totalMercanciasExentas).toFixed(5)),facturaCli.totalVenta=parseFloat((facturaCli.totalGravado+facturaCli.totalExento).toFixed(5)),facturaCli.totalVentaneta=parseFloat((facturaCli.totalVenta-facturaCli.totalDescuentos).toFixed(5)),facturaCli.totalComprobante=parseFloat((facturaCli.totalVentaneta+facturaCli.totalImpuesto).toFixed(5)),$("#send").addClass("Nosend"),$("#send").attr("disabled","disabled"),$.ajax({type:"POST",url:"class/Factura.php",data:{action:"Create",obj:JSON.stringify(facturaCli)}}).done(function(e){ticketPrint(e)}).fail(function(e){swal({type:"error",text:"Error al facturar!",timer:1e3})}).always(function(){})}