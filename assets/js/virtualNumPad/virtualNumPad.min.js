function sendVal(a){switch(localStorage.setItem("lsTarjetaCredito","0.00"),localStorage.setItem("lsEfectivo",document.getElementById("txt_pagoCash").value),localStorage.setItem("lsVuelto",document.getElementById("vuelto").innerHTML.substr(11)),localStorage.setItem("lsDif","0.00"),a){case a>=0&&a<=9?a:-1:addNumber(a);break;case"enter":enter();break;case"left":left();break;default:return!1}}function sendRef(a){switch(localStorage.setItem("lsTarjetaCredito",document.getElementById("total_pagar").innerHTML.substr(16)),localStorage.setItem("lsEfectivo","0.00"),localStorage.setItem("lsVuelto","0.00"),localStorage.setItem("lsDif","0.00"),a){case a>=0&&a<=9?a:-1:addRef(a);break;case"enter":enter();break;case"left":leftRef();break;default:return!1}}function addNumber(a){$(".valPago").val($(".valPago").val()+a),validarMonto()}function addRef(a){$(".valRef").val($(".valRef").val()+a),validarRef()}function left(){precio=$(".valPago").val(),$(".valPago").val(precio.substring(0,precio.length-1)),validarMonto()}function leftRef(){precio=$(".valRef").val(),$(".valRef").val(precio.substring(0,precio.length-1)),validarRef()}function validarMonto(){if(totalXPagar=parseFloat($("#total")[0].textContent.replace("¢","")),$(".valPago").val()>=totalXPagar){document.getElementById("vuelto").style.color="#FF0000",document.getElementById("vuelto").textContent="Su vuelto: "+(-1*totalXPagar+parseFloat($(".valPago").val())).toString();var a=document.getElementsByClassName("Nosend")[0];a.classList.add("green","letter","send"),a.classList.remove("Nosend")}else if(document.getElementById("vuelto").style.color="#73879C",document.getElementById("vuelto").textContent="Su vuelto: ",document.getElementsByClassName("send")[0]){var t=document.getElementsByClassName("send")[0];t.classList.remove("letter","send","green")}}function validarRef(){if($(".valRef")[0].value.length>=5){var a=document.getElementsByClassName("Nosend")[0];a.classList.add("green","letter","send"),a.classList.remove("Nosend")}else if(document.getElementsByClassName("send")[0]){var t=document.getElementsByClassName("send")[0];t.classList.add("Nosend"),t.classList.remove("letter","send","green")}}function enter(){$("#modalFormaPago").attr("disabled","disabled"),$(".input_pago").attr("disabled","disabled"),$(".close").attr("disabled","disabled"),$(".factura-modal-lg").modal({backdrop:"static",keyboard:!1}),facturar()}function crearFactura(){var a="Create",e=new Object;e.totalVenta=0,$(t.rows().data()).each(function(t,o){switch(o[0]){case 0:e.totalVenta=e.totalVenta+parseFloat(precioMediano);break;case 1:e.totalVenta=e.totalVenta+parseFloat(precioGrande)}$.ajax({type:"POST",url:"class/Factura.php",data:{action:a,obj:JSON.stringify(e)}}).done(function(a){var t="3b31b046-75eb-11e8-abed-f2f00eda2018";crearDetalle(t)}).fail(function(a){distr.showError(a)})})}function crearDetalle(a){var e="Create",o=new Object;o.idFactura=a,$(t.rows().data()).each(function(a,t){switch(t[0]){case 0:o.totalVenta=parseFloat(precioMediano);break;case 1:o.totalVenta=parseFloat(precioGrande)}o.numeroLinea=a,o.detalle=`${t[1]}, ${t[3]}, ${t[5]}, ${t[7]}`,$.ajax({type:"POST",url:"class/productoXFactura.php",data:{action:e,obj:JSON.stringify(o)}}).done(function(a){var t="3b31b046-75eb-11e8-abed-f2f00eda2018";crearOrden(t)}).fail(function(a){distr.showError(a)})})}function crearOrden(a){var e="Create",o=new Object;o.idFactura=a,$(t.rows().data()).each(function(a,t){o.idTamano=t[0],o.idSabor1=t[2],o.idSabor2=t[4],o.idTopping=t[6],$.ajax({type:"POST",url:"class/OrdenXFactura.php",data:{action:e,obj:JSON.stringify(o)}}).done(function(a){swal({type:"success",text:"Número de orden de Distribución:",showConfirmButton:!0})}).fail(function(a){distr.showError(a)}).always(function(){location.reload()})})}function facturar(){$("#keyboard li").css("pointer-events","none");var a=document.getElementsByClassName("send")[0];a.classList.add("green","letter","Nosend"),a.classList.remove("send");var e="Create";facturaCli.totalVenta=0,facturaCli.totalDescuentos=0,facturaCli.totalVentaneta=0,facturaCli.totalImpuesto=0,facturaCli.totalComprobante=0,facturaCli.montoEfectivo=0,facturaCli.montoTarjeta=0,facturaCli.detalleFactura=[],facturaCli.detalleOrden=[],$(t.rows().data()).each(function(a,t){var e,o;switch(t[0]){case 0:e=parseFloat((precioMediano.precio/1.13).toFixed(5)),o=precioMediano.id;break;case 1:e=parseFloat((precioGrande.precio/1.13).toFixed(5)),o=precioGrande.id}var l=new Object;l.idPrecio=o,l.numeroLinea=a+1,l.idTipoCodigo=1,l.codigo=t[1],l.cantidad=1,l.idUnidadMedida=78,l.detalle=`${t[1]}, ${t[3]}, ${t[5]}, ${t[7]}`,l.precioUnitario=e,l.montoTotal=parseFloat((l.precioUnitario*l.cantidad).toFixed(5)),l.montoDescuento=0,l.naturalezaDescuento="No aplican descuentos",l.subTotal=parseFloat((l.montoTotal-l.montoDescuento).toFixed(5)),l.impuestos=[];var r=0;impuesto=new Object,impuesto.idCodigoImpuesto=1,impuesto.codigoTarifa=8,impuesto.tarifa=13,impuesto.monto=parseFloat((l.subTotal*(impuesto.tarifa/100)).toFixed(5)),r+=impuesto.monto,l.montoTotalLinea=parseFloat((l.subTotal+r).toFixed(5)),l.impuestos.push(impuesto),facturaCli.detalleFactura.push(l),facturaCli.totalVenta=parseFloat((facturaCli.totalVenta+l.montoTotal).toFixed(5)),facturaCli.totalDescuentos=parseFloat((facturaCli.totalDescuentos+l.montoDescuento).toFixed(5)),facturaCli.totalImpuesto=parseFloat((facturaCli.totalImpuesto+r).toFixed(5));var n=new Object;n.idTamano=t[0],n.idSabor1=t[2],n.idSabor2=t[4],n.idTopping=t[6],facturaCli.detalleOrden.push(n)}),null==$("#txt_pagoCash").val()?facturaCli.montoEfectivo="0":facturaCli.montoEfectivo=$("#txt_pagoCash").val(),null==$("#total_pagar").text()?facturaCli.montoTarjeta="0":facturaCli.montoTarjeta=$("#total_pagar").text().substring(16),facturaCli.totalServGravados=0,facturaCli.totalServExentos=0,facturaCli.totalMercanciasGravadas=facturaCli.totalVenta,facturaCli.totalMercanciasExentas=0,facturaCli.totalGravado=parseFloat((facturaCli.totalServGravados+facturaCli.totalMercanciasGravadas).toFixed(5)),facturaCli.totalExento=parseFloat((facturaCli.totalServExentos+facturaCli.totalMercanciasExentas).toFixed(5)),facturaCli.totalVenta=parseFloat((facturaCli.totalGravado+facturaCli.totalExento).toFixed(5)),facturaCli.totalVentaneta=parseFloat((facturaCli.totalVenta-facturaCli.totalDescuentos).toFixed(5)),facturaCli.totalComprobante=parseFloat((facturaCli.totalVentaneta+facturaCli.totalImpuesto).toFixed(5)),$("#send").addClass("Nosend"),$("#send").attr("disabled","disabled"),$.ajax({type:"POST",url:"class/Factura.php",data:{action:e,obj:JSON.stringify(facturaCli)}}).done(function(a){ticketPrint(a)}).fail(function(a){swal({type:"error",text:"Error al facturar!",timer:1e3})}).always(function(){})}var selector="#txt_pago";