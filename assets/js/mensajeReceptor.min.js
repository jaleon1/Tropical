class MensajeReceptor{constructor(id,clave,identificacion,montoImpuesto,totalComprobante,identificacionReceptor,consecutivoFE,mensaje,detalle,tb_mensajeReceptor,fechaInicial,fechaFinal){this.id=id||null,this.clave=clave||"",this.identificacion=identificacion||"",this.montoImpuesto=montoImpuesto||"",this.totalComprobante=totalComprobante||"",this.identificacionReceptor=identificacionReceptor||"",this.consecutivoFE=consecutivoFE||null,this.mensaje=mensaje||null,this.detalle=detalle||null,this.tb_mensajeReceptor=tb_mensajeReceptor||null,this.fechaInicial=fechaInicial||null,this.fechaFinal=fechaFinal||null}showInfo(){$(".close").click(),swal({type:"success",title:"Listo!",showConfirmButton:!1,timer:1e3})}showError(e){var data=JSON.parse(e.responseText);swal({type:"error",title:"Oops...",text:"Algo no está bien ("+data.code+"): "+data.msg})}drawRespuesta(e){var tRespuesta=$("#tRespuesta").DataTable({data:e,destroy:!0,searching:!1,paging:!1,info:!1,ordering:!1,order:[[0,"desc"]],columns:[{title:"CLAVE",data:"clave"},{title:"ESTADO",data:"estado"}]})}CargaListaMR(){var rc=mr.tb_mensajeReceptor;mr.tb_mensajeReceptor=[],$.ajax({type:"POST",url:"class/mensajeReceptor.php",data:{action:"ReadAllbyRange",obj:JSON.stringify(mr)}}).done(function(e){mr.tb_mensajeReceptor=rc,"null"!=e?mr.drawMensajeReceptor(e):swal({type:"success",title:"Listo, no hay facturas que cargar!",showConfirmButton:!1,timer:2e3})}).fail(function(e){mr.showError(e)})}CargaListaMRExterna(){var rc=mr.tb_mensajeReceptor;mr.tb_mensajeReceptor=[],$.ajax({type:"POST",url:"class/mensajeReceptor.php",data:{action:"ReadAllbyRangeExterna",obj:JSON.stringify(mr)}}).done(function(e){mr.tb_mensajeReceptor=rc,"null"!=e?mr.drawMensajeReceptorExterna(e):swal({type:"success",title:"Listo, no hay facturas que cargar!",showConfirmButton:!1,timer:2e3})}).fail(function(e){mr.showError(e)})}drawMensajeReceptor(e){var mesajesReceptor=JSON.parse(e);this.tb_mensajeReceptor=$("#tb_mensajeReceptor").DataTable({data:mesajesReceptor,footerCallback:function(row,data,start,end,display){var api=this.api(),intVal=function(i){return"string"==typeof i?1*i.replace(/[\¢,]/g,""):"number"==typeof i?i:0},totalComprobante=display.map(el=>data[el][5]).reduce((a,b)=>intVal(a)+intVal(b),0);$(api.column(5).footer()).html("¢"+parseFloat(Number(totalComprobante)).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,","))},responsive:!0,destroy:!0,order:[[2,"desc"]],dom:"Bfrtip",buttons:[{extend:"excelHtml5",exportOptions:{columns:[1,2,3,4,5]},messageTop:"Mensaje Receptor"},{extend:"pdfHtml5",orientation:"landscape",messageTop:"Mensaje Receptor",exportOptions:{columns:[1,2,3,4,5]}}],language:{infoEmpty:"Sin Mensajes Receptor",emptyTable:"Sin Mensajes Receptor",search:"Buscar",zeroRecords:"No hay resultados",lengthMenu:"Mostrar _MENU_ registros",paginate:{first:"Primera",last:"Ultima",next:"Siguiente",previous:"Anterior"}},columnDefs:[{className:"text-right",targets:[4,5,7]}],columns:[{title:"ID",data:"id",className:"itemId",width:"auto",searchable:!1},{title:"CONSECUTIVO",data:"consecutivoFe",width:"auto"},{title:"FECHA DE CREACION",data:"fechaCreacion",width:"auto"},{title:"DETALLE",data:"detalle",width:"auto"},{title:"MENSAJE",data:"mensaje",width:"auto",mRender:function(e){switch(e){case"1":return'<i class="fa fa-check-square-o" aria-hidden="true" style="color:green"> Aceptado</i>';case"2":return'<i class="fa fa-exclamation-triangle" aria-hidden="true" style="color:#FF6F00"> Aceptado Parcialmente</i>';case"3":return'<i class="fa fa-times-circle" aria-hidden="true" style="color:red"> Rechazado</i>'}}},{title:"TOTAL",data:"totalComprobante",width:"auto",type:"formatted-num",mRender:function(e){return"¢"+parseFloat(e).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",")}},{title:"IDEMISOR",data:"idEmisor",width:"auto",visible:!1,searchable:!1},{title:"ESTADO",data:"idEstadoComprobante",mRender:function(e){switch(e){case"1":return'<i class="fa fa-paper-plane" aria-hidden="true" style="color:red"> Sin Enviar</i>';case"2":return'<i class="fa fa-paper-plane" aria-hidden="true" style="color:green"> Enviado</i>';case"3":return'<i class="fa fa-check-square-o" aria-hidden="true" style="color:green"> Aceptado</i>';case"4":return'<i class="fa fa-times-circle" aria-hidden="true" style="color:red"> Rechazado</i>';case"5":return'<i class="fa fa-exclamation-triangle" aria-hidden="true" style="color:#FF6F00"> Otro</i>';case"99":return'<i class="fa fa-exclamation-triangle" aria-hidden="true" style="color:green"> Reportado</i>';default:return"Desconocido"}}},{title:"ACCION",orderable:!1,searchable:!1,width:"auto",render:function(data,type,row,meta){if(null!=data)return'<i class="fa fa-check-square-o" aria-hidden="true" style="color:green">&nbsp Factura Cancelada!</i>';switch(row.idEstadoComprobante){case"1":return"<button class=btnEnviarFactura>&nbsp Enviar</button>";case"2":return'<i class="fa fa-check-square-o">&nbsp Enviada</i>';case"3":return'<i class="fa fa-check-square-o" aria-hidden="true" style="color:green"> Aceptado!</i>';case"4":return"<button class=btnNC_CreateFact_Ref>&nbsp Cancelar & Reenviar</button>";case"5":return'<i class="fa fa-cloud-upload" aria-hidden="true">&nbsp Enviar Contingencia</i>';default:return"<button>Soporte</button>"}}}]})}drawMensajeReceptorExterna(e){var mesajesReceptor=JSON.parse(e);this.tb_mensajeReceptor=$("#tb_mensajeReceptorExterna").DataTable({data:mesajesReceptor,footerCallback:function(row,data,start,end,display){var api=this.api(),intVal=function(i){return"string"==typeof i?1*i.replace(/[\¢,]/g,""):"number"==typeof i?i:0},totalComprobante=display.map(el=>data[el][5]).reduce((a,b)=>intVal(a)+intVal(b),0);$(api.column(5).footer()).html("¢"+parseFloat(Number(totalComprobante)).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,","))},responsive:!0,destroy:!0,order:[[2,"desc"]],dom:"Bfrtip",buttons:[{extend:"excelHtml5",exportOptions:{columns:[1,2,3,4,5]},messageTop:"Mensaje Receptor"},{extend:"pdfHtml5",orientation:"landscape",messageTop:"Mensaje Receptor",exportOptions:{columns:[1,2,3,4,5]}}],language:{infoEmpty:"Sin Mensajes Receptor",emptyTable:"Sin Mensajes Receptor",search:"Buscar",zeroRecords:"No hay resultados",lengthMenu:"Mostrar _MENU_ registros",paginate:{first:"Primera",last:"Ultima",next:"Siguiente",previous:"Anterior"}},columnDefs:[{className:"text-right",targets:[4,5,7]}],columns:[{title:"ID",data:"id",className:"itemId",width:"auto",searchable:!1},{title:"CONSECUTIVO",data:"consecutivoFe",width:"auto"},{title:"FECHA DE CREACION",data:"fechaCreacion",width:"auto"},{title:"DETALLE",data:"detalle",width:"auto"},{title:"MENSAJE",data:"mensaje",width:"auto"},{title:"TOTAL",data:"totalComprobante",width:"auto",type:"formatted-num",mRender:function(e){return"¢"+parseFloat(e).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",")}},{title:"IDEMISOR",data:"idEmisor",width:"auto",visible:!1,searchable:!1},{title:"ESTADO",data:"idEstadoComprobante",width:"auto",mRender:function(e){var tipo="1";return"0"==e&&(tipo="CASO 0"),"1"==e&&(tipo="CASO 1"),"2"==e&&(tipo="CASO 2"),"3"==e&&(tipo="CASO 3"),"4"==e&&(tipo="CASO 4"),"5"==e&&(tipo="CASO 5"),tipo}},{title:"ACCION",orderable:!1,searchable:!1,width:"auto",render:function(data,type,row,meta){var e=row.idEstadoComprobante,opcion=0;if(null==e)opcion=0;else{if("0"==e)return'<button type="button" class="btn btn-xs btn-default">CASO 0</button>';if("1"==e)return'<button type="button" class="btn btn-xs btn-primary">CASO 1</button>';if("2"==e)return'<button type="button" class="btn btn-xs btn-success">CASO 2</button>';if("3"==e)return'<button type="button" class="btn btn-xs btn-info">CASO 3</button>';if("4"==e)return'<button type="button" class="btn btn-xs btn-warning">CASO 4</button>';if("5"==e)return'<button type="button" class="btn btn-xs btn-danger">CASO 5</button>'}}}]})}Init(){var validator=new FormValidator({events:["blur","input","change"]},document.forms.frmXml);$("#frmXml").submit(function(e){var validatorResult;return e.preventDefault(),validator.checkAll(this).valid&&null!=dz&&dz.processQueue(),!1}),document.forms.frmXml.onreset=function(e){validator.reset()},$(function(){$(document).ajaxStart(NProgress.start).ajaxStop(NProgress.done)}),$("#btnSubmit").click(function(){$("#m").val($("#tipoMensaje option:selected").val()),$("#d").val($("#detalleMensaje").val()),$("#frmXml").submit()}),Dropzone.options.frmXml={init:function(){this.on("addedfile",function(file){dz=this}),this.on("complete",function(file){var data=JSON.parse(file.xhr.response);return mr.drawRespuesta(data),$("#modalRespuesta").show(),!0}),this.on("error",function(file){var data=JSON.parse(file.xhr.response);sesion.in(data),swal({type:"error",title:"Oops...",text:"Archivo no válido."}),this.removeFile(file)}),this.on("canceled",function(file){swal({type:"error",title:"Oops...",text:"Certificado cancelado"})})},autoProcessQueue:!1,acceptedFiles:"text/xml",parallelUploads:100,uploadMultiple:!0,addRemoveLinks:!0,autoDiscover:!1}}}var dz;let mr=new MensajeReceptor;