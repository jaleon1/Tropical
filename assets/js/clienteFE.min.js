class ClienteFE{constructor(e,i,t,n,o,a,r,l,c,s,d,f,p,u,h,$,v,C,m,b,g,w,T,P,S){this.id=e||null,this.nombre=i||"",this.idCodigoPais=t||"",this.idTipoIdentificacion=n||"",this.identificacion=o||"",this.nombreComercial=a||"",this.idProvincia=r||null,this.idCanton=l||null,this.idDistrito=c||null,this.idBarrio=s||null,this.otrasSenas=d||null,this.idCodigoPaisTel=f||null,this.numTelefono=p||null,this.idCodigoPaisFax=u||null,this.numTelefonoFax=h||null,this.correoElectronico=$||null,this.username=v||null,this.password=C||null,this.certificado=m||null,this.idBodega=b||null,this.filename=g||null,this.filesize=w||null,this.filetype=T||null,this.estadoCertificado=P||0,this.pinp12=S||null}get tUpdate(){return this.update="update"}get tSelect(){return this.select="select"}set viewEventHandler(e){this.viewType=e}get Read(){var e=null==this.id?"ReadAll":"Read";"ReadAll"==e&&0==$("#tclientefe tbody").length||$.ajax({type:"POST",url:"class/ClienteFE.php",data:{action:e,id:this.id}}).done(function(e){clientefe.Reload(e)}).fail(function(e){clientefe.showError(e)})}get ReadProfile(){var e="ReadProfile";$.ajax({type:"POST",url:"class/ClienteFE.php",data:{action:e}}).done(function(e){'"INTERNA"'==e?($(".x_content").html("<center><h3>Registro de Contribuyente Interno</h3></center>"),$(".x_content").append("<center><span>Dirígase a la Agencia Principal para realizar cambios</span></center>")):clientefe.ShowItemData(e)}).fail(function(e){clientefe.showError(e)})}get ReadAllTipoIdentificacion(){var e="ReadAllTipoIdentificacion";$.ajax({type:"POST",url:"class/ClienteFE.php",data:{action:e}}).done(function(e){$("#idBodega").val($(".call_Bodega").text()),clientefe.ShowList(e,$("#idTipoIdentificacion")),clientefe.ReadProfile}).fail(function(e){clientefe.showError(e)})}get ReadAllUbicacion(){this.idProvincia=$("#idProvincia option:selected").val()||1,this.idCanton=$("#idCanton option:selected").val()||1,this.idDistrito=$("#idDistrito option:selected").val()||1,$("#idProvincia").html(""),$("#idCanton").html(""),$("#idDistrito").html(""),$("#idBarrio").html(""),$("#idProvincia").attr("title","Cargando ..."),$("#idCanton").attr("title","Cargando ..."),$("#idDistrito").attr("title","Cargando ..."),$("#idBarrio").attr("title","Cargando ..."),$("#idProvincia").selectpicker("refresh"),$("#idCanton").selectpicker("refresh"),$("#idDistrito").selectpicker("refresh"),$("#idBarrio").selectpicker("refresh");var e="ReadAllUbicacion";$("#btnSubmit").attr("disabled","disabled"),$.ajax({type:"POST",url:"class/ClienteFE.php",data:{action:e,idProvincia:this.idProvincia,idCanton:this.idCanton,idDistrito:this.idDistrito}}).done(function(e){clientefe.ShowListUbicacion(e),$("#btnSubmit").removeAttr("disabled")}).fail(function(e){clientefe.showError(e)})}get ReadAllProvincia(){var e="ReadAllProvincia";$("#btnSubmit").attr("disabled","disabled"),$.ajax({type:"POST",url:"class/ClienteFE.php",data:{action:e}}).done(function(e){clientefe.ShowList(e,$("#idProvincia")),$("#idProvincia option[value="+clientefe.idProvincia+"]").prop("selected",!0),$("#idProvincia").selectpicker("refresh"),clientefe.ReadAllCanton}).fail(function(e){clientefe.showError(e)})}get ReadAllCanton(){$("#idCanton").html(""),$("#idDistrito").html(""),$("#idBarrio").html(""),$("#idCanton").attr("title","Cargando ..."),$("#idDistrito").attr("title","Cargando ..."),$("#idBarrio").attr("title","Cargando ..."),$("#idCanton").selectpicker("refresh"),$("#idDistrito").selectpicker("refresh"),$("#idBarrio").selectpicker("refresh");var e="ReadAllCanton";this.idProvincia=$("#idProvincia option:selected").val()||1,$.ajax({type:"POST",url:"class/ClienteFE.php",data:{action:e,idProvincia:this.idProvincia}}).done(function(e){clientefe.ShowList(e,$("#idCanton")),$("#idCanton option[value="+clientefe.idCanton+"]").prop("selected",!0),$("#idCanton").selectpicker("refresh"),clientefe.ReadAllDistrito}).fail(function(e){clientefe.showError(e)})}get ReadAllDistrito(){$("#idDistrito").html(""),$("#idBarrio").html(""),$("#idDistrito").attr("title","Cargando ..."),$("#idBarrio").attr("title","Cargando ..."),$("#idDistrito").selectpicker("refresh"),$("#idBarrio").selectpicker("refresh");var e="ReadAllDistrito";this.idCanton=$("#idCanton option:selected").val()||1,$.ajax({type:"POST",url:"class/ClienteFE.php",data:{action:e,idCanton:this.idCanton}}).done(function(e){clientefe.ShowList(e,$("#idDistrito")),$("#idDistrito option[value="+clientefe.idDistrito+"]").prop("selected",!0),$("#idDistrito").selectpicker("refresh"),clientefe.ReadAllBarrio}).fail(function(e){clientefe.showError(e)})}get ReadAllBarrio(){$("#idBarrio").html(""),$("#idBarrio").attr("title","Cargando ..."),$("#idBarrio").selectpicker("refresh");var e="ReadAllBarrio";this.idDistrito=$("#idDistrito option:selected").val()||1,$.ajax({type:"POST",url:"class/ClienteFE.php",data:{action:e,idDistrito:this.idDistrito}}).done(function(e){clientefe.ShowList(e,$("#idBarrio")),$("#idBarrio option[value="+clientefe.idBarrio+"]").prop("selected",!0),$("#idBarrio").selectpicker("refresh"),$("#btnSubmit").removeAttr("disabled")}).fail(function(e){clientefe.showError(e)})}get Save(){var e=null==this.id?"Create":"Update";this.nombre=$("#nombre").val();var i=11111111,t=99999999;return this.codigoSeguridad=Math.floor(Math.random()*(i-t+1)+t),this.idCodigoPais="52",this.idTipoIdentificacion=$("#idTipoIdentificacion option:selected").val(),this.identificacion=$("#identificacion").val(),this.nombreComercial=$("#nombreComercial").val(),"null"==$("#idProvincia option:selected").val()||null==$("#idProvincia option:selected").val()?(swal({type:"warning",title:"Ubicación...",text:"Debe seleccionar la Provincia"}),!1):(this.idProvincia=$("#idProvincia option:selected").val(),"null"==$("#idCanton option:selected").val()||null==$("#idCanton option:selected").val()?(swal({type:"warning",title:"Ubicación...",text:"Debe seleccionar el Cantón"}),!1):(this.idCanton=$("#idCanton option:selected").val(),"null"==$("#idDistrito option:selected").val()||null==$("#idDistrito option:selected").val()?(swal({type:"warning",title:"Ubicación...",text:"Debe seleccionar el Cantón"}),!1):(this.idDistrito=$("#idDistrito option:selected").val(),this.idBarrio=$("#idBarrio option:selected").val(),this.otrasSenas=$("#otrasSenas").val(),this.idCodigoPaisTel="52",this.numTelefono=$("#numTelefono").val(),this.correoElectronico=$("#correoElectronico").val(),this.username=$("#username").val(),this.password=$("#password").val(),this.pinp12=$("#pinp12").val(),null==this.certificado?(swal({type:"warning",title:"Cerfificado...",text:"Debe agregar el certificado"}),!1):($("#btnSubmit").attr("disabled","disabled"),void $.ajax({type:"POST",url:"class/ClienteFE.php",data:{action:e,objC:JSON.stringify(this)}}).done(function(){null!=dz?dz.processQueue():clientefe.showInfo()}).fail(function(e){clientefe.showError(e)}).always(function(){$("#btnSubmit").removeAttr("disabled")})))))}get Delete(){$.ajax({type:"POST",url:"class/ClienteFE.php",data:{action:"Delete",id:this.id}}).done(function(){swal({type:"success",title:"Eliminado!",showConfirmButton:!1,timer:1e3})}).fail(function(e){clientefe.showError(e)}).always(function(){clientefe=new clientefe,clientefe.Read})}get DeleteCertificado(){$.ajax({type:"POST",url:"class/ClienteFE.php",data:{action:"DeleteCertificado",certificado:clientefe.certificado,id:clientefe.id}}).done(function(){$("#filelist").html(""),clientefe.certificado=null,swal({type:"success",title:"Eliminado!",showConfirmButton:!1,timer:1e3})}).fail(function(e){clientefe.showError(e)})}get DownloadCertificado(){$.ajax({type:"GET",url:"class/downloadCert.php",data:{action:"DownloadCertificado",certificado:clientefe.certificado,id:clientefe.id}}).done(function(){}).fail(function(e){clientefe.showError(e)})}Reload(e){null==this.id?this.ShowAll(e):this.ShowItemData(e)}ShowListUbicacion(e){if("[]"!=e){var i,t=JSON.parse(e);$.each(t,function(e,t){switch(e){case 0:i=$("#idProvincia");break;case 1:i=$("#idCanton");break;case 2:i=$("#idDistrito");break;case 3:i=$("#idBarrio")}i.html(""),$.each(t,function(e,t){i.append(`\n                        <option value=${t.id} ${0==e?"selected":""}> ${t.value}</option>\n                    `)}),i.selectpicker("refresh")})}else swal({type:"error",title:"Oops...",text:"Algo no está bien, La lista de ubicaciones no puede ser cargada",footer:"<a href>Contacte a Soporte Técnico</a>"})}ShowList(e,i){if("[]"!=e){var t=JSON.parse(e);i.html(""),$.each(t,function(e,t){i.append(`\n                    <option value=${t.id} ${0==e?"selected":""} >${t.value}</option>\n                `)}),i.selectpicker("refresh")}else swal({type:"error",title:"Oops...",text:"Algo no está bien, La lista no puede ser cargada"})}showInfo(){$(".close").click(),swal({type:"success",title:"Listo!",showConfirmButton:!1,timer:1e3})}showError(e){var i=JSON.parse(e.responseText);swal({type:"error",title:"Oops...",text:"Algo no está bien ("+i.code+"): "+i.msg,footer:"<a href>Contacte a Soporte Técnico</a>"})}ClearCtls(){$("#id").val(""),$("#nombre").val(""),$("#idCodigoPais").val(""),$("#idTipoIdentificacion option").prop("selected",!1),$("#idTipoIdentificacion").selectpicker("refresh"),$("#identificacion").val(""),$("#nombreComercial").val(""),$("#idProvincia option").prop("selected",!1),$("#idCanton option").prop("selected",!1),$("#idDistrito option").prop("selected",!1),$("#idBarrio option").prop("selected",!1),$("#otrasSenas").val(""),$("#numTelefono").val(""),$("#correoElectronico").val(""),$("#username").val(""),$("#password").val(""),$("#pinp12").val(""),$("#filelist").html(""),null!=dz&&dz.removeAllFiles()}ShowAll(e){var i=$("#tclientefe").DataTable();i.clear(),i.rows.add(JSON.parse(e)),i.draw()}ShowItemData(e){if(this.ClearCtls(),"null"!=e){var i=JSON.parse(e);clientefe=new ClienteFE(i.id,i.nombre,i.idCodigoPais,i.idTipoIdentificacion,i.identificacion,i.nombreComercial,i.idProvincia,i.idCanton,i.idDistrito,i.idBarrio,i.otrasSenas,i.idCodigoPaisTel,i.numTelefono,i.idCodigoPaisFax,i.numTelefonoFax,i.correoElectronico,i.username,i.password,i.certificado,i.idBodega,i.filename,i.filesize,i.filetype,i.estadoCertificado,i.pinp12),$("#id").val(clientefe.id),$("#nombre").val(clientefe.nombre),$("#contribuyente").html("<h3>Registro de Contribuyente de Factura Electrónica: "+$(".call_Bodega").text()+"<h3>"),$("#idCodigoPais").val(clientefe.idCodigoPais),$("#idTipoIdentificacion option[value="+clientefe.idTipoIdentificacion+"]").prop("selected",!0),$("#idTipoIdentificacion").selectpicker("refresh"),clientefe.ReglasTipoIdentificacion(clientefe.idTipoIdentificacion),$("#identificacion").val(clientefe.identificacion),$("#nombreComercial").val(clientefe.nombreComercial),clientefe.ReadAllProvincia,$("#otrasSenas").val(clientefe.otrasSenas),$("#numTelefono").val(clientefe.numTelefono),$("#correoElectronico").val(clientefe.correoElectronico),$("#username").val(clientefe.username),$("#password").val(clientefe.password),$("#pinp12").val(clientefe.pinp12),$("#filelist").append(`\n                <div class="btn-group">\n                    <button type="button" class="btn ${1==clientefe.estadoCertificado?"btn-success":"btn-danger"}">${clientefe.certificado}</button>\n                    <button type="button" class="btn ${1==clientefe.estadoCertificado?"btn-success":"btn-danger"} dropdown-toggle" data-toggle="dropdown" aria-expanded="false">\n                        <span class="caret"></span>\n                        <span class="sr-only">Toggle Dropdown</span>\n                    </button>\n                    ${1==clientefe.estadoCertificado?`\n                        <ul class="dropdown-menu" role="menu">\n                            <li><a id='certEliminar'>Eliminar</a></li>\n                            <li class="divider"></li>\n                            <li><a href='class/downloadCert.php?certificado=${clientefe.certificado}' id='certDescargar'>Descargar</a></li>\n                        </ul>`:""}\n                </div>           \n            `).fadeIn(),0==clientefe.estadoCertificado&&swal({type:"error",title:"Oops...",text:"Ha ocurrido un error al localizar el Certificado.",footer:"<a href>Contacte a Soporte Técnico</a>"}),$("#certEliminar").click(function(){swal({title:"Eliminar Certificado?",text:"Esta acción es irreversible!",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",confirmButtonClass:"btn btn-success",cancelButtonClass:"btn btn-danger"}).then(e=>{e.value&&clientefe.DeleteCertificado})}),testConn.res=!0}else clientefe.ReadAllUbicacion}ReglasTipoIdentificacion(e){var i,t,n;switch(e){case"1":i="([0-9])",t="9,9",n="9 digitos, sin cero al inicio y sin guiones.";break;case"2":i="([0-9]){9,10}$",t="10,10",n="10 digitos y sin guiones.";break;case"3":i="([0-9]){9,10}$",t="11,12",n="11 o 12 digitos, sin ceros al inicio y sin guiones.";break;case"4":i="([0-9]){10,10}$",t="10,10",n="10 digitos y sin guiones."}$("#identificacion").attr("pattern",i),$("#identificacion").attr("data-validate-length-range",t),$("#identificacion").attr("placeholder",n);new FormValidator({events:["blur","input","change"]},document.forms.frm)}probarConexion(e=!1){if(""!=$("#username").val()&&""!=$("#password").val()){var i="testConnection";this.username=$("#username").val(),this.password=$("#password").val(),$.ajax({type:"POST",url:"class/ClienteFE.php",data:{action:i,username:this.username,password:this.password,correoElectronico:this.correoElectronico}}).done(function(i){"true"==i?(e&&swal({type:"info",title:"Conexión...",text:"Conexión Exitosa!"}),testConn.res=!0):(e&&swal({type:"error",title:"Conexión...",text:"Conexión Fallida, revise su usuario y contraseña de ATV.",footer:"<a href>Contacte a Soporte Técnico</a>"}),testConn.res=!1)}).fail(function(e){usuario.showError(e)})}}Init(){var e=new FormValidator({events:["blur","input","change"]},document.forms.frm);$("#frm").submit(function(i){i.preventDefault();var t=e.checkAll(this);return t.valid&&clientefe.Save,!1}),document.forms.frm.onreset=function(i){e.reset()},$(function(){$(document).ajaxStart(function(){NProgress.start(),$("button").prop("disabled",!0)}).ajaxStop(function(){NProgress.done(),$("button").prop("disabled",!1)})}),$("#idTipoIdentificacion").on("change",function(i){e.reset(),clientefe.ReglasTipoIdentificacion($(this).val())}),$("#idProvincia").on("change",function(e){clientefe.ReadAllCanton}),$("#idCanton").on("change",function(e){clientefe.ReadAllDistrito}),$("#idDistrito").on("change",function(e){clientefe.ReadAllBarrio}),$("#btnSubmit").click(function(){$("#frm").submit()}),Dropzone.options.frmLlave={init:function(){this.on("addedfile",function(e){dz=this,clientefe.certificado=dz.files[0].name}),this.on("complete",function(e){"UPLOADED"!=e.xhr.response?(swal({type:"error",title:"Oops...",text:"Ha ocurrido un error al subir el Certificado.",footer:"<a href>Contacte a Soporte Técnico</a>"}),$(e.previewElement).addClass("dz-error-message"),$("#filelist").html(""),clientefe.certificado=null):clientefe.showInfo()}),this.on("error",function(e){swal({type:"error",title:"Oops...",text:"Certificado con error",footer:"<a href>Contacte a Soporte Técnico</a>"}),this.removeFile(e)}),this.on("canceled",function(e){swal({type:"error",title:"Oops...",text:"Certificado cancelado",footer:"<a href>Contacte a Soporte Técnico</a>"})})},autoProcessQueue:!1,acceptedFiles:"application/x-pkcs12",maxFiles:1,addRemoveLinks:!0,autoDiscover:!1},$("#btnEliminar").click(function(){}),$("#btnTest").click(function(){clientefe.probarConexion(!0)}),$("#btnTest").click(function(){clientefe.probarConexion(!0)}),$("#username").on("change",function(e){clientefe.probarConexion()}),$("#password").on("change",function(e){clientefe.probarConexion()})}}var dz;let clientefe=new ClienteFE;var testConn={aInternal:!1,aListener:function(e){},set res(e){this.aInternal=e,this.aListener(e)},get res(){return this.aInternal},registerListener:function(e){this.aListener=e}};testConn.registerListener(function(e){e?($("#btnTest").text("Conexión Ok!"),$("#btnTest").attr("class","btn btn-success")):($("#btnTest").text("Probar Conexión"),$("#btnTest").attr("class","btn btn-danger"))});