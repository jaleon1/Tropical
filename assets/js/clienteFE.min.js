class ClienteFE{constructor(id,nombre,idCodigoPais,idTipoIdentificacion,identificacion,nombreComercial,idProvincia,idCanton,idDistrito,idBarrio,otrasSenas,idCodigoPaisTel,numTelefono,idCodigoPaisFax,numTelefonoFax,correoElectronico,username,password,certificado,idBodega,filename,filesize,filetype,estadoCertificado,pinp12){this.id=id||null,this.nombre=nombre||"",this.idCodigoPais=idCodigoPais||"",this.idTipoIdentificacion=idTipoIdentificacion||"",this.identificacion=identificacion||"",this.nombreComercial=nombreComercial||"",this.idProvincia=idProvincia||null,this.idCanton=idCanton||null,this.idDistrito=idDistrito||null,this.idBarrio=idBarrio||null,this.otrasSenas=otrasSenas||null,this.idCodigoPaisTel=idCodigoPaisTel||null,this.numTelefono=numTelefono||null,this.idCodigoPaisFax=idCodigoPaisFax||null,this.numTelefonoFax=numTelefonoFax||null,this.correoElectronico=correoElectronico||null,this.username=username||null,this.password=password||null,this.certificado=certificado||null,this.idBodega=idBodega||null,this.filename=filename||null,this.filesize=filesize||null,this.filetype=filetype||null,this.estadoCertificado=estadoCertificado||0,this.pinp12=pinp12||null}get tUpdate(){return this.update="update"}get tSelect(){return this.select="select"}set viewEventHandler(_t){this.viewType=_t}get Read(){var miAccion=null==this.id?"ReadAll":"Read";"ReadAll"==miAccion&&0==$("#tclientefe tbody").length||$.ajax({type:"POST",url:"class/ClienteFE.php",data:{action:miAccion,id:this.id}}).done(function(e){clientefe.Reload(e)}).fail(function(e){clientefe.showError(e)})}get ReadProfile(){var miAccion="ReadProfile";$.ajax({type:"POST",url:"class/ClienteFE.php",data:{action:miAccion}}).done(function(e){clientefe.ShowItemData(e)}).fail(function(e){clientefe.showError(e)})}get ReadAllTipoIdentificacion(){var miAccion="ReadAllTipoIdentificacion";$.ajax({type:"POST",url:"class/ClienteFE.php",data:{action:miAccion}}).done(function(e){$("#idBodega").val($(".call_Bodega").text()),clientefe.ShowList(e,$("#idTipoIdentificacion")),clientefe.ReadProfile}).fail(function(e){clientefe.showError(e)})}get ReadAllUbicacion(){this.idProvincia=$("#idProvincia option:selected").val()||1,this.idCanton=$("#idCanton option:selected").val()||1,this.idDistrito=$("#idDistrito option:selected").val()||1,$("#idProvincia").html(""),$("#idCanton").html(""),$("#idDistrito").html(""),$("#idBarrio").html(""),$("#idProvincia").attr("title","Cargando ..."),$("#idCanton").attr("title","Cargando ..."),$("#idDistrito").attr("title","Cargando ..."),$("#idBarrio").attr("title","Cargando ..."),$("#idProvincia").selectpicker("refresh"),$("#idCanton").selectpicker("refresh"),$("#idDistrito").selectpicker("refresh"),$("#idBarrio").selectpicker("refresh");var miAccion="ReadAllUbicacion";$("#btnSubmit").attr("disabled","disabled"),$.ajax({type:"POST",url:"class/ClienteFE.php",data:{action:miAccion,idProvincia:this.idProvincia,idCanton:this.idCanton,idDistrito:this.idDistrito}}).done(function(e){clientefe.ShowListUbicacion(e),$("#btnSubmit").removeAttr("disabled")}).fail(function(e){clientefe.showError(e)})}get ReadAllProvincia(){var miAccion="ReadAllProvincia";$("#btnSubmit").attr("disabled","disabled"),$.ajax({type:"POST",url:"class/ClienteFE.php",data:{action:miAccion}}).done(function(e){clientefe.ShowList(e,$("#idProvincia")),$("#idProvincia option[value="+clientefe.idProvincia+"]").prop("selected",!0),$("#idProvincia").selectpicker("refresh"),clientefe.ReadAllCanton}).fail(function(e){clientefe.showError(e)})}get ReadAllCanton(){$("#idCanton").html(""),$("#idDistrito").html(""),$("#idBarrio").html(""),$("#idCanton").attr("title","Cargando ..."),$("#idDistrito").attr("title","Cargando ..."),$("#idBarrio").attr("title","Cargando ..."),$("#idCanton").selectpicker("refresh"),$("#idDistrito").selectpicker("refresh"),$("#idBarrio").selectpicker("refresh");var miAccion="ReadAllCanton";this.idProvincia=$("#idProvincia option:selected").val()||1,$.ajax({type:"POST",url:"class/ClienteFE.php",data:{action:miAccion,idProvincia:this.idProvincia}}).done(function(e){clientefe.ShowList(e,$("#idCanton")),$("#idCanton option[value="+clientefe.idCanton+"]").prop("selected",!0),$("#idCanton").selectpicker("refresh"),clientefe.ReadAllDistrito}).fail(function(e){clientefe.showError(e)})}get ReadAllDistrito(){$("#idDistrito").html(""),$("#idBarrio").html(""),$("#idDistrito").attr("title","Cargando ..."),$("#idBarrio").attr("title","Cargando ..."),$("#idDistrito").selectpicker("refresh"),$("#idBarrio").selectpicker("refresh");var miAccion="ReadAllDistrito";this.idCanton=$("#idCanton option:selected").val()||1,$.ajax({type:"POST",url:"class/ClienteFE.php",data:{action:miAccion,idCanton:this.idCanton}}).done(function(e){clientefe.ShowList(e,$("#idDistrito")),$("#idDistrito option[value="+clientefe.idDistrito+"]").prop("selected",!0),$("#idDistrito").selectpicker("refresh"),clientefe.ReadAllBarrio}).fail(function(e){clientefe.showError(e)})}get ReadAllBarrio(){$("#idBarrio").html(""),$("#idBarrio").attr("title","Cargando ..."),$("#idBarrio").selectpicker("refresh");var miAccion="ReadAllBarrio";this.idDistrito=$("#idDistrito option:selected").val()||1,$.ajax({type:"POST",url:"class/ClienteFE.php",data:{action:miAccion,idDistrito:this.idDistrito}}).done(function(e){clientefe.ShowList(e,$("#idBarrio")),$("#idBarrio option[value="+clientefe.idBarrio+"]").prop("selected",!0),$("#idBarrio").selectpicker("refresh"),$("#btnSubmit").removeAttr("disabled")}).fail(function(e){clientefe.showError(e)})}get Save(){var miAccion=null==this.id?"Create":"Update";this.nombre=$("#nombre").val();var max=11111111,min=99999999;return this.codigoSeguridad=Math.floor(-88888887*Math.random()+min),this.idCodigoPais="52",this.idTipoIdentificacion=$("#idTipoIdentificacion option:selected").val(),this.identificacion=$("#identificacion").val(),this.nombreComercial=$("#nombreComercial").val(),"null"==$("#idProvincia option:selected").val()||null==$("#idProvincia option:selected").val()?(swal({type:"warning",title:"Ubicación...",text:"Debe seleccionar la Provincia"}),!1):(this.idProvincia=$("#idProvincia option:selected").val(),"null"==$("#idCanton option:selected").val()||null==$("#idCanton option:selected").val()?(swal({type:"warning",title:"Ubicación...",text:"Debe seleccionar el Cantón"}),!1):(this.idCanton=$("#idCanton option:selected").val(),"null"==$("#idDistrito option:selected").val()||null==$("#idDistrito option:selected").val()?(swal({type:"warning",title:"Ubicación...",text:"Debe seleccionar el Cantón"}),!1):(this.idDistrito=$("#idDistrito option:selected").val(),this.idBarrio=$("#idBarrio option:selected").val(),this.otrasSenas=$("#otrasSenas").val(),this.idCodigoPaisTel="52",this.numTelefono=$("#numTelefono").val(),this.correoElectronico=$("#correoElectronico").val(),this.username=$("#username").val(),this.password=$("#password").val(),this.pinp12=$("#pinp12").val(),null==this.certificado?(swal({type:"warning",title:"Cerfificado...",text:"Debe agregar el certificado"}),!1):($("#btnSubmit").attr("disabled","disabled"),void $.ajax({type:"POST",url:"class/ClienteFE.php",data:{action:miAccion,objC:JSON.stringify(this)}}).done(function(){null!=dz?dz.processQueue():clientefe.showInfo()}).fail(function(e){clientefe.showError(e)}).always(function(){$("#btnSubmit").removeAttr("disabled")})))))}get Delete(){$.ajax({type:"POST",url:"class/ClienteFE.php",data:{action:"Delete",id:this.id}}).done(function(){swal({type:"success",title:"Eliminado!",showConfirmButton:!1,timer:1e3})}).fail(function(e){clientefe.showError(e)}).always(function(){(clientefe=new clientefe).Read})}get DeleteCertificado(){$.ajax({type:"POST",url:"class/ClienteFE.php",data:{action:"DeleteCertificado",certificado:clientefe.certificado,id:clientefe.id}}).done(function(){$("#filelist").html(""),clientefe.certificado=null,swal({type:"success",title:"Eliminado!",showConfirmButton:!1,timer:1e3})}).fail(function(e){clientefe.showError(e)})}get DownloadCertificado(){$.ajax({type:"GET",url:"class/downloadCert.php",data:{action:"DownloadCertificado",certificado:clientefe.certificado,id:clientefe.id}}).done(function(){}).fail(function(e){clientefe.showError(e)})}Reload(e){null==this.id?this.ShowAll(e):this.ShowItemData(e)}ShowListUbicacion(e){if("[]"!=e){var data=JSON.parse(e),selector;$.each(data,function(i,item){switch(i){case 0:selector=$("#idProvincia");break;case 1:selector=$("#idCanton");break;case 2:selector=$("#idDistrito");break;case 3:selector=$("#idBarrio")}selector.html(""),$.each(item,function(n,d){selector.append(`\n                        <option value=${d.id} ${0==n?"selected":""}> ${d.value}</option>\n                    `)}),selector.selectpicker("refresh")})}else swal({type:"error",title:"Oops...",text:"Algo no está bien, La lista de ubicaciones no puede ser cargada",footer:"<a href>Contacte a Soporte Técnico</a>"})}ShowList(e,selector){if("[]"!=e){var data=JSON.parse(e);selector.html(""),$.each(data,function(i,item){selector.append(`\n                    <option value=${item.id} ${0==i?"selected":""} >${item.value}</option>\n                `)}),selector.selectpicker("refresh")}else swal({type:"error",title:"Oops...",text:"Algo no está bien, La lista no puede ser cargada",footer:"<a href>Contacte a Soporte Técnico</a>"})}showInfo(){$(".close").click(),swal({type:"success",title:"Listo!",showConfirmButton:!1,timer:1e3})}showError(e){var data=JSON.parse(e.responseText);swal({type:"error",title:"Oops...",text:"Algo no está bien ("+data.code+"): "+data.msg,footer:"<a href>Contacte a Soporte Técnico</a>"})}ClearCtls(){$("#id").val(""),$("#nombre").val(""),$("#idCodigoPais").val(""),$("#idTipoIdentificacion option").prop("selected",!1),$("#idTipoIdentificacion").selectpicker("refresh"),$("#identificacion").val(""),$("#nombreComercial").val(""),$("#idProvincia option").prop("selected",!1),$("#idCanton option").prop("selected",!1),$("#idDistrito option").prop("selected",!1),$("#idBarrio option").prop("selected",!1),$("#otrasSenas").val(""),$("#numTelefono").val(""),$("#correoElectronico").val(""),$("#username").val(""),$("#password").val(""),$("#pinp12").val(""),$("#filelist").html(""),null!=dz&&dz.removeAllFiles()}ShowAll(e){var t=$("#tclientefe").DataTable();t.clear(),t.rows.add(JSON.parse(e)),t.draw()}ShowItemData(e){if(this.ClearCtls(),"null"!=e){var data=JSON.parse(e);clientefe=new ClienteFE(data.id,data.nombre,data.idCodigoPais,data.idTipoIdentificacion,data.identificacion,data.nombreComercial,data.idProvincia,data.idCanton,data.idDistrito,data.idBarrio,data.otrasSenas,data.idCodigoPaisTel,data.numTelefono,data.idCodigoPaisFax,data.numTelefonoFax,data.correoElectronico,data.username,data.password,data.certificado,data.idBodega,data.filename,data.filesize,data.filetype,data.estadoCertificado,data.pinp12),$("#id").val(clientefe.id),$("#nombre").val(clientefe.nombre),$("#contribuyente").html("<h3>Registro de Contribuyente de Factura Electrónica: "+$(".call_Bodega").text()+"<h3>"),$("#idCodigoPais").val(clientefe.idCodigoPais),$("#idTipoIdentificacion option[value="+clientefe.idTipoIdentificacion+"]").prop("selected",!0),$("#idTipoIdentificacion").selectpicker("refresh"),clientefe.ReglasTipoIdentificacion(clientefe.idTipoIdentificacion),$("#identificacion").val(clientefe.identificacion),$("#nombreComercial").val(clientefe.nombreComercial),clientefe.ReadAllProvincia,$("#otrasSenas").val(clientefe.otrasSenas),$("#numTelefono").val(clientefe.numTelefono),$("#correoElectronico").val(clientefe.correoElectronico),$("#username").val(clientefe.username),$("#password").val(clientefe.password),$("#pinp12").val(clientefe.pinp12),$("#filelist").append(`\n                <div class="btn-group">\n                    <button type="button" class="btn ${1==clientefe.estadoCertificado?"btn-success":"btn-danger"}">${clientefe.certificado}</button>\n                    <button type="button" class="btn ${1==clientefe.estadoCertificado?"btn-success":"btn-danger"} dropdown-toggle" data-toggle="dropdown" aria-expanded="false">\n                        <span class="caret"></span>\n                        <span class="sr-only">Toggle Dropdown</span>\n                    </button>\n                    ${1==clientefe.estadoCertificado?`\n                        <ul class="dropdown-menu" role="menu">\n                            <li><a id='certEliminar'>Eliminar</a></li>\n                            <li class="divider"></li>\n                            <li><a href='class/downloadCert.php?certificado=${clientefe.certificado}' id='certDescargar'>Descargar</a></li>\n                        </ul>`:""}\n                </div>           \n            `).fadeIn(),0==clientefe.estadoCertificado&&swal({type:"error",title:"Oops...",text:"Ha ocurrido un error al localizar el Certificado.",footer:"<a href>Contacte a Soporte Técnico</a>"}),$("#certEliminar").click(function(){swal({title:"Eliminar Certificado?",text:"Esta acción es irreversible!",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",confirmButtonClass:"btn btn-success",cancelButtonClass:"btn btn-danger"}).then(result=>{result.value&&clientefe.DeleteCertificado})})}else clientefe.ReadAllUbicacion}ReglasTipoIdentificacion(opt){var p,lr,ph;switch(opt){case"1":p="([0-9])",lr="9,9",ph="9 digitos, sin cero al inicio y sin guiones.";break;case"2":p="([0-9]){9,10}$",lr="10,10",ph="10 digitos y sin guiones.";break;case"3":p="([0-9]){9,10}$",lr="11,12",ph="11 o 12 digitos, sin ceros al inicio y sin guiones.";break;case"4":p="([0-9]){10,10}$",lr="10,10",ph="10 digitos y sin guiones."}$("#identificacion").attr("pattern",p),$("#identificacion").attr("data-validate-length-range",lr),$("#identificacion").attr("placeholder",ph);var validator=new FormValidator({events:["blur","input","change"]},document.forms.frm)}probarConexion(showMess=!1){if(""!=$("#username").val()&&""!=$("#password").val()){var miAccion="testConnection";this.username=$("#username").val(),this.password=$("#password").val(),$.ajax({type:"POST",url:"class/clienteFE.php",data:{action:miAccion,username:this.username,password:this.password,correoElectronico:this.correoElectronico}}).done(function(e){"true"==e?(showMess&&swal({type:"info",title:"Conexión...",text:"Conexión Exitosa!"}),testConn.res=!0):(showMess&&swal({type:"error",title:"Conexión...",text:"Conexión Fallida, revise su usuario y contraseña de ATV.",footer:"<a href>Contacte a Soporte Técnico</a>"}),testConn.res=!1)}).fail(function(e){usuario.showError(e)})}}Init(){var validator=new FormValidator({events:["blur","input","change"]},document.forms.frm);$("#frm").submit(function(e){var validatorResult;return e.preventDefault(),validator.checkAll(this).valid&&clientefe.Save,!1}),document.forms.frm.onreset=function(e){validator.reset()},$(function(){$(document).ajaxStart(NProgress.start).ajaxStop(NProgress.done)}),$("#idTipoIdentificacion").on("change",function(e){validator.reset(),clientefe.ReglasTipoIdentificacion($(this).val())}),$("#idProvincia").on("change",function(e){clientefe.ReadAllCanton}),$("#idCanton").on("change",function(e){clientefe.ReadAllDistrito}),$("#idDistrito").on("change",function(e){clientefe.ReadAllBarrio}),$("#btnSubmit").click(function(){$("#frm").submit()}),Dropzone.options.frmLlave={init:function(){this.on("addedfile",function(file){dz=this,clientefe.certificado=dz.files[0].name}),this.on("complete",function(file){"UPLOADED"!=file.xhr.response?(swal({type:"error",title:"Oops...",text:"Ha ocurrido un error al subir el Certificado.",footer:"<a href>Contacte a Soporte Técnico</a>"}),$(file.previewElement).addClass("dz-error-message"),$("#filelist").html(""),clientefe.certificado=null):clientefe.showInfo()}),this.on("error",function(file){swal({type:"error",title:"Oops...",text:"Certificado con error",footer:"<a href>Contacte a Soporte Técnico</a>"}),this.removeFile(file)}),this.on("canceled",function(file){swal({type:"error",title:"Oops...",text:"Certificado cancelado",footer:"<a href>Contacte a Soporte Técnico</a>"})})},autoProcessQueue:!1,acceptedFiles:"application/x-pkcs12",maxFiles:1,addRemoveLinks:!0,autoDiscover:!1},$("#btnEliminar").click(function(){}),$("#btnTest").click(function(){clientefe.probarConexion(!0)}),$("#btnTest").click(function(){clientefe.probarConexion(!0)}),$("#username").on("change",function(e){clientefe.probarConexion()}),$("#password").on("change",function(e){clientefe.probarConexion()})}}var dz;let clientefe=new ClienteFE;var testConn={aInternal:!1,aListener:function(val){},set res(val){this.aInternal=val,this.aListener(val)},get res(){return this.aInternal},registerListener:function(listener){this.aListener=listener}};testConn.registerListener(function(val){val?($("#btnTest").text("Conexión Ok!"),$("#btnTest").attr("class","btn btn-success")):($("#btnTest").text("Probar Conexión"),$("#btnTest").attr("class","btn btn-danger"))});