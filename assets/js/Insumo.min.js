class Insumo{constructor(t,e,a,o,i,n,s,r,d,l){this.id=t||null,this.codigo=e||"",this.nombre=a||"",this.descripcion=o||"",this.saldoCantidad=i||0,this.saldoCosto=n||0,this.costoPromedio=s||0,this.tablainsumo=r||[],this.fechaInicial=d||"",this.fechaFinal=l||""}get Read(){var t=null==this.id?"ReadAll":"Read";-1!=document.URL.indexOf("OrdenSalida.html")&&(t="ReadSaldoPositivo"),"ReadAll"==t&&0==$("#tableBody-Insumo").length||$.ajax({type:"POST",url:"class/Insumo.php",data:{action:t,id:this.id}}).done(function(t){insumo.Reload(t)}).fail(function(t){insumo.showError(t)})}get Save(){$("#btnInsumo").attr("disabled","disabled");var t=null==this.id?"Create":"Update";this.codigo=$("#codigo").val(),this.nombre=$("#nombre").val(),this.descripcion=$("#descripcion").val(),this.saldoCantidad=$("#saldoCantidad").val(),this.saldoCosto=$("#saldoCosto").val(),this.costoPromedio=$("#costoPromedio").val();var e=this.tablainsumo;this.tablainsumo=[],$.ajax({type:"POST",url:"class/Insumo.php",data:{action:t,obj:JSON.stringify(this)}}).done(function(t){this.tablainsumo=e,insumo.showInfo()}).fail(function(t){insumo.showError(t)}).always(function(){$("#btnInsumo").removeAttr("disabled"),insumo=new Insumo,insumo.ClearCtls(),insumo.Read,$("#nombre").focus(),insumo.ValorDefault()})}get Delete(){$.ajax({type:"POST",url:"class/Insumo.php",data:{action:"Delete",id:this.id}}).done(function(t){var e=JSON.parse(t);0==e?swal({type:"success",title:"Eliminado!",showConfirmButton:!1,timer:1e3}):1==e.status?swal({type:"error",title:"No es posible eliminar...",text:"El registro que intenta eliminar ya se ecnuentra liquidado"}):swal({type:"error",title:"Ha ocurrido un error...",text:"El registro no ha sido eliminado",footer:"<a href>Contacte a Soporte Técnico</a>"})}).fail(function(t){insumo.showError(t)}).always(function(){insumo=new Insumo,insumo.Read})}get ReadInventarioInsumo(){var t=null==this.id?"ReadAllInventario":"ReadbyInsumo";"ReadAll"==t&&0==$("#tableBody-InsumoReporte").length||$.ajax({type:"POST",url:"class/Insumo.php",data:{action:t,id:this.id}}).done(function(t){insumo.ShowAllInventario(t)}).fail(function(t){insumo.showError(t)})}CargaInsumoRango(){var t=insumo.tablainsumo;insumo.tablainsumo=[],$.ajax({type:"POST",url:"class/Insumo.php",data:{action:"ReadAllbyRange",obj:JSON.stringify(insumo)}}).done(function(e){insumo.tablainsumo=t,insumo.ShowAllInventario(e)})}ReadCierreInventario(){var t=insumo.tablainsumo;insumo.tablainsumo=[],$.ajax({type:"POST",url:"class/Insumo.php",data:{action:"ReadCierreInventario",obj:JSON.stringify(insumo)}}).done(function(e){insumo.tablainsumo=t,insumo.ShowAllInventario(e)})}Reload(t){null==this.id?this.ShowAll(t):this.ShowItemData(t)}showInfo(){$(".close").click(),swal({type:"success",title:"Listo!",showConfirmButton:!1,timer:1e3})}showError(t){var e=JSON.parse(t.responseText);swal({type:"error",title:"Oops...",text:"Algo no está bien ("+e.code+"): "+e.msg,footer:"<a href>Contacte a Soporte Técnico</a>"})}ClearCtls(){$("#id").val(""),$("#codigo").val(""),$("#nombre").val(""),$("#descripcion").val(""),$("#saldoCantidad").val("0"),$("#saldoCosto").val("0"),$("#costoPromedio").val("0")}ShowAll(t){var e=$("#dsInsumo").DataTable();0==e.rows().count()?(e.clear(),e.rows.add(JSON.parse(t)),e.draw(),$(document).on("click","#dsInsumo tbody tr",-1!=document.URL.indexOf("OrdenSalida.html")?insumo.AddInsumo:insumo.UpdateEventHandler),$(document).on("click",".delete",insumo.DeleteEventHandler)):(e.clear(),e.rows.add(JSON.parse(t)),e.draw())}ShowAllInventario(t){var e=$("#dsInsumoReporte").DataTable();e.rows().count(),e.clear(),e.rows.add(JSON.parse(t)),e.draw()}ReadbyCode(t){""!=t&&(insumo.codigo=t,$.ajax({type:"POST",url:"class/Insumo.php",data:{action:"ReadByCode",obj:JSON.stringify(insumo)}}).done(function(t){insumo.ValidateInsumoFac(t)}).fail(function(t){insumo.showError(t)}))}ValidateInsumoFac(t){if("[]"!=t){if("false"!=t&&""!=t){var e=JSON.parse(t)[0];insumo.id=e.id,insumo.codigo=e.codigo,insumo.nombre=e.nombre,insumo.descripcion=e.descripcion,insumo.saldoCantidad=e.saldoCantidad,insumo.costoPromedio=e.costoPromedio;var a=!1;0!=document.getElementById("tInsumo").rows.length&&null!=insumo&&$(document.getElementById("tInsumo").rows).each(function(t,e){e.childNodes[0].innerText==insumo.id&&(a=!0,swal({type:"warning",title:"Orden de Compra",text:"El item "+insumo.codigo+" ya se encuentra en la lista",showConfirmButton:!1,timer:3e3}))}),0==a&&(insumo.agregarItem(),$("#p_searhInsumo").val(""))}}else swal({type:"warning",title:"Orden de Compra",text:"El item "+insumo.codigo+" No existe.",showConfirmButton:!1,timer:3e3})}agregarItem(){if(insumo.saldoCantidad<=0)return swal({type:"warning",title:"Merma",text:"El item "+insumo.codigo+" no tiene cantidad disponible.",showConfirmButton:!1,timer:3e3}),!1;var t=ti.row.add(insumo).draw().node();$("td:eq(3) input",t).attr({id:"prec_"+insumo.codigo,max:insumo.saldoCantidad,min:"1",step:"1",value:"1"}).on("keyup keypress mouseup",function(t){parseFloat($(this).attr("max"))<parseFloat($(this).val())&&(swal({type:"warning",title:"Saldo Insuficiente",text:"El producto contiene unicamente "+producto.saldoCantidad+" unidades",showConfirmButton:!1,timer:3e3}),$(this).val(producto.saldoCantidad))})}DeleteInsumoMerma(t){ti.row($(t).parents("tr")).remove().draw()}setTableOrdenSalida(){this.tablainsumo=$("#dsInsumo").DataTable({responsive:!0,destroy:!0,order:[[1,"asc"]],columnDefs:[{className:"text-right",targets:[4]}],columns:[{title:"ID",data:"id",className:"itemId",searchable:!1},{title:"CODIGO",data:"codigo"},{title:"NOMBRE",data:"nombre"},{title:"DESCRIPCION",data:"descripcion"},{title:"SALDO CANTIDAD",data:"saldoCantidad"},{title:"SALDO COSTO",data:"saldoCosto",className:"oculto_saldoCosto",visible:!1},{title:"COSTO PROMEDIO",data:"costoPromedio",className:"oculto_costoPromedio",visible:!1},{title:"ACCIÓN",orderable:!1,searchable:!1,mRender:function(){return'<a class="update"> <i class="glyphicon glyphicon-edit" > </i> Editar </a> | <a class="delete"> <i class="glyphicon glyphicon-trash"> </i> </a>'},visible:!1}]})}setTableInventarioInsumo(){jQuery.extend(jQuery.fn.dataTableExt.oSort,{"formatted-num-pre":function(t){return t="-"===t||""===t?0:t.replace(/[^\d\-\.]/g,""),parseFloat(t)},"formatted-num-asc":function(t,e){return t-e},"formatted-num-desc":function(t,e){return e-t}}),this.tablainsumo=$("#dsInsumo").DataTable({responsive:!0,destroy:!0,order:[[1,"asc"]],dom:"Bfrtip",buttons:[{extend:"excelHtml5",exportOptions:{columns:[1,2,3,4,5,6]},messageTop:"Inventario Materia Prima"},{extend:"pdfHtml5",messageTop:"Inventario Materia Prima",exportOptions:{columns:[1,2,3,4,5,6]}}],language:{infoEmpty:"Sin Insumos Registrados",emptyTable:"Sin Insumos Registrados",search:"Buscar",zeroRecords:"No hay resultados",lengthMenu:"Mostrar _MENU_ registros",paginate:{first:"Primera",last:"Ultima",next:"Siguiente",previous:"Anterior"}},columnDefs:[{className:"text-right",targets:[4,5,6]}],columns:[{title:"ID",data:"id",className:"itemId",width:"auto",searchable:!1},{title:"CODIGO",data:"codigo",width:"auto"},{title:"NOMBRE",data:"nombre",width:"auto"},{title:"DESCRIPCION",data:"descripcion",width:"auto"},{title:"SALDO CANTIDAD",data:"saldoCantidad",width:"auto"},{title:"SALDO COSTO",data:"saldoCosto",width:"auto",type:"formatted-num",mRender:function(t){return"¢"+parseFloat(t).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",")}},{title:"COSTO PROMEDIO",data:"costoPromedio",width:"auto",type:"formatted-num",mRender:function(t){return"¢"+parseFloat(t).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",")}},{title:"ACCIÓN",orderable:!1,searchable:!1,className:"buttons",width:"auto",mRender:function(){return'<a class="delete" style="cursor: pointer;"> <i class="glyphicon glyphicon-trash"> </i> </a>'}}]})}setTableInventarioOrdenSalida(){this.tablainsumo=$("#dsInsumo").DataTable({responsive:!0,destroy:!0,order:[[1,"asc"]],language:{infoEmpty:"Sin Ordenes de Producción Registradas",emptyTable:"Sin Ordenes de Producción Registradas",search:"Buscar",zeroRecords:"No hay resultados",lengthMenu:"Mostrar _MENU_ registros",paginate:{first:"Primera",last:"Ultima",next:"Siguiente",previous:"Anterior"}},columnDefs:[{className:"text-right",targets:[4]}],columns:[{title:"ID",data:"id",className:"itemId",searchable:!1},{title:"CODIGO",data:"codigo"},{title:"NOMBRE",data:"nombre"},{title:"DESCRIPCION",data:"descripcion"},{title:"SALDO CANTIDAD",data:"saldoCantidad"},{title:"SALDO COSTO",data:"saldoCosto",className:"oculto_saldoCosto",visible:!1},{title:"COSTO PROMEDIO",data:"costoPromedio",className:"oculto_costoPromedio",visible:!1},{title:"ACCIÓN",orderable:!1,searchable:!1,mRender:function(){return'<a class="update"> <i class="glyphicon glyphicon-edit" > </i> Editar </a> | <a class="delete"> <i class="glyphicon glyphicon-trash"> </i> </a>'},visible:!1}]})}setTableMerma(){ti=$("#tInsumo").DataTable({responsive:!0,destroy:!0,order:[[1,"asc"]],language:{infoEmpty:"Sin Registros",emptyTable:"Sin Registros",search:"Buscar",zeroRecords:"No hay resultados",lengthMenu:"Mostrar _MENU_ registros",paginate:{first:"Primera",last:"Ultima",next:"Siguiente",previous:"Anterior"}},columnDefs:[{className:"text-right",targets:[5]}],columns:[{title:"Id",data:"id",className:"itemId",searchable:!1,width:"auto"},{title:"CODIGO",data:"codigo",width:"auto"},{title:"Insumo",data:"nombre",width:"auto"},{title:"Costo Promedio",data:"costoPromedio",className:"itemId",width:"auto"},{title:"CANTIDAD",width:"15%",data:null,defaultContent:'<input class="cantidad form-control" min="1" max="9999999999" step="1" style="text-align:right;"  type="number" value=1>'},{title:"Observaciones",width:"30%",data:null,defaultContent:'<input class="cantidad form-control" type="text">'},{title:"Acción",orderable:!1,searchable:!1,mRender:function(){return'<a class="delete" style="cursor: pointer;" onclick="insumo.DeleteInsumoMerma(this)" > <i class="glyphicon glyphicon-trash"> </i></a>'},visible:!0}]})}setTableInventarioInsumoReporte(){jQuery.extend(jQuery.fn.dataTableExt.oSort,{"formatted-num-pre":function(t){return t="-"===t||""===t?0:t.replace(/[^\d\-\.]/g,""),parseFloat(t)},"formatted-num-asc":function(t,e){return t-e},"formatted-num-desc":function(t,e){return e-t}}),this.tablainsumo=$("#dsInsumoReporte").DataTable({responsive:!0,destroy:!0,order:[1,"desc"],dom:"Bfrtip",buttons:[{extend:"excelHtml5",exportOptions:{columns:[1,3,5,7,9,10,11,12,13,14,15]},messageTop:"Movimientos de Materia Prima"},{extend:"pdfHtml5",orientation:"landscape",exportOptions:{columns:[1,3,5,7,9,10,11,12,13,14,15]}}],language:{infoEmpty:"Sin movimientos de Materia Prima",emptyTable:"Sin movimientos de Materia Prima",search:"Buscar",zeroRecords:"No hay resultados",lengthMenu:"Mostrar _MENU_ registros",paginate:{first:"Primera",last:"Ultima",next:"Siguiente",previous:"Anterior"}},columns:[{title:"ID",data:"id",className:"itemId",width:"auto",searchable:!1},{title:"FECHA",data:"fecha",width:"auto"},{title:"ORDEN COMPRA",data:"idOrdenCompra",visible:!1},{title:"ENTRADA",data:"ordenEntrada",width:"auto"},{title:"ORDEN SALIDA",data:"idOrdenSalida",visible:!1},{title:"SALIDA",data:"ordenSalida",width:"auto"},{title:"ID INSUMO",data:"idInsumo",visible:!1},{title:"INSUMO",data:"insumo",width:"auto"},{title:"ENTRADA",data:"entrada",width:"auto",mRender:function(t){return null==t?"0":t}},{title:"SALIDA",data:"salida",width:"auto",mRender:function(t){return null==t?"0":t}},{title:"SALDO",data:"saldo",width:"auto"},{title:"COSTO ADQUISICION",data:"costoAdquisicion",width:"auto",type:"formatted-num",mRender:function(t){return null==t?"¢0":"¢"+parseFloat(t).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",")}},{title:"VALOR ENTRADA",data:"valorEntrada",width:"auto",type:"formatted-num",mRender:function(t){return null==t?"¢0":"¢"+parseFloat(t).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",")}},{title:"VALOR SALIDA",data:"valorSalida",width:"auto",type:"formatted-num",mRender:function(t){return null==t?"¢0":"¢"+parseFloat(t).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",")}},{title:"VALOR SALDO",data:"valorSaldo",width:"auto",type:"formatted-num",mRender:function(t){return null==t?"¢0":"¢"+parseFloat(t).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",")}},{title:"COSTO PROMEDIO",data:"costoPromedio",width:"auto",type:"formatted-num",mRender:function(t){return null==t?"¢0":"¢"+parseFloat(t).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",")}}]})}AddInsumo(){var t=$(this).find("td:eq(0)").html(),e=$(this).find("td:eq(1)").html(),a=$(this).find("td:eq(2)").html(),o=$(this).find("td:eq(3)").html(),i=$(this).find("td:eq(4)").html(),n=insumo.tablainsumo.row(this).data()[5],s=insumo.tablainsumo.row(this).data()[6];ordenSalida.AddInsumoEventHandler(t,e,a,o,i,n,s)}UpdateEventHandler(){insumo.id=$(this).find(".itemId").text(),insumo.Read}ShowItemData(t){this.ClearCtls();var e=JSON.parse(t)[0];$("#id").val(e.id),$("#codigo").val(e.codigo),$("#nombre").val(e.nombre),$("#descripcion").val(e.descripcion),$("#saldoCantidad").val(e.saldoCantidad),$("#saldoCosto").val(parseFloat(e.saldoCosto).toFixed(2)),$("#costoPromedio").val(parseFloat(e.costoPromedio).toFixed(2)),$(".bs-example-modal-lg").modal("toggle")}DeleteEventHandler(){insumo.id=$(this).parents("tr").find(".itemId").text(),swal({title:"Eliminar?",text:"Esta acción es irreversible!",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",confirmButtonClass:"btn btn-success",cancelButtonClass:"btn btn-danger"}).then(t=>{t.value&&insumo.Delete})}ValorDefault(){$("#saldoCantidad").val("0"),$("#saldoCosto").val("0.00"),$("#costoPromedio").val("0.00")}Init(){var t=new FormValidator({events:["blur","input","change"]},document.forms[0]);$("#frmInsumo").submit(function(e){e.preventDefault();var a=t.checkAll(this);return a.valid&&insumo.Save,!1}),document.forms[0].onreset=function(e){t.reset()}}}let insumo=new Insumo;var ti;