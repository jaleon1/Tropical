class Merma{constructor(id,idItem,cantidad,descripcion,fecha,fechaInicial,fechaFinal){this.id=id||null,this.idItem=idItem||null,this.cantidad=cantidad||0,this.descripcion=descripcion||"",this.fecha=fecha||null,this.fechaInicial=fechaInicial||"",this.fechaFinal=fechaFinal||""}get Read(){NProgress.start();var miAccion=null==this.id?"ReadAll":"Read";"ReadAll"==miAccion&&0==$("#tMerma tbody").length||$.ajax({type:"POST",url:"class/merma.php",data:{action:miAccion,id:this.id}}).done(function(e){merma.Reload(e)}).fail(function(e){merma.showError(e)}).always(NProgress.done())}CargaListaMermaRango(){$.ajax({type:"POST",url:"class/merma.php",data:{action:"ReadAllbyRange",obj:JSON.stringify(merma)}}).done(function(e){merma.ShowAll(e)})}ReadbyCodeConsumible(cod){""!=cod&&(merma.codigo=cod,$.ajax({type:"POST",url:"class/Producto.php",data:{action:"ReadByCode",obj:JSON.stringif(merma)}}).done(function(e){merma.ValidatePrdMerma(e)}).fail(function(e){merma.showError(e)}))}showError(e){var data=JSON.parse(e.responseText);swal({type:"error",title:"Oops...",text:"Algo no está bien ("+data.code+"): "+data.msg,footer:"<a href>Contacte a Soporte Técnico</a>"})}DeleteMerma(e){swal({title:"Devolver Merma?",text:"Esta acción es irreversible!",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",confirmButtonClass:"btn btn-success",cancelButtonClass:"btn btn-danger"}).then(result=>{result.value&&(merma.id=$(e).parents("tr").find("td:eq(0)").text(),merma.idRel=$(e).parents("tr").find("td:eq(1)").text(),merma.consecutivo=$(e).parents("tr").find("td:eq(3)").text(),merma.cantidad=$(e).parents("tr").find("td:eq(6)").text(),$.ajax({type:"POST",url:"class/merma.php",data:{action:"rollback",id:merma.id,idRel:merma.idRel,consecutivo:merma.consecutivo,cantidad:merma.cantidad}}).done(function(){merma.showInfo(),t.row($(e).parents("tr")).remove().draw()}).fail(function(e){merma.showError(e)}).always(function(){}))})}setTable(buttons=!0,nPaging=10){t=$("#tMerma").DataTable({responsive:!0,destroy:!0,order:[[6,"desc"]],dom:"Bfrtip",buttons:[{extend:"excelHtml5",exportOptions:{columns:[1,2,3,4,5,6,7]},messageTop:"Lista de Mermas"},{extend:"pdfHtml5",messageTop:"Lista de Mermas",exportOptions:{columns:[1,2,3,4,5,6,7]}}],language:{infoEmpty:"Sin Mermas Registradas",emptyTable:"Sin Mermas Registradas",search:"Buscar",zeroRecords:"No hay resultados",lengthMenu:"Mostrar _MENU_ registros",paginate:{first:"Primera",last:"Ultima",next:"Siguiente",previous:"Anterior"}},columnDefs:[{className:"text-right",targets:[5]}],columns:[{title:"ID",data:"id",className:"itemId",searchable:!1},{title:"IdRel",data:"idRel",className:"itemId",searchable:!1,width:"auto"},{title:"CODIGO",data:"codigo"},{title:"CONSECUTIVO",data:"consecutivo"},{title:"NOMBRE",data:"nombre"},{title:"DESCRIPCION",data:"descripcion"},{title:"CANTIDAD",data:"cantidad"},{title:"OBSERVACIONES",data:"descripcion"},{title:"FECHA",data:"fecha"},{title:"Acción",orderable:!1,searchable:!1,mRender:function(){return'<a class="delete" style="cursor: pointer;" onclick="merma.DeleteMerma(this)" > <i class="glyphicon glyphicon-trash"> </i></a>'},visible:!0}]})}Reload(e){null==this.id?this.ShowAll(e):this.ShowItemData(e)}ShowAll(e){var t=$("#tMerma").DataTable();t.clear(),t.rows.add(JSON.parse(e)),$("td:eq(5)").attr({align:"right"}),t.order([1,"desc"]).draw()}showInfo(){swal({type:"success",title:"Listo!",showConfirmButton:!1,timer:1e3})}crear(){var miAccion="Create",listaok=!0;return merma.listaInsumo=[],$("#tInsumo tbody tr").each(function(i,item){if("Sin Registros"!=$(item).find("td:eq(0)")[0].textContent){var objlista=new Object;objlista.idInsumo=$(item).find("td:eq(0)")[0].textContent,objlista.costo=$(item).find("td:eq(3)")[0].textContent,objlista.cantidad=$(item).find("td:eq(4) input").val(),null!=$(item).find("td:eq(5) input").val()&&""==$(item).find("td:eq(5) input").val()&&(swal({type:"warning",title:"Descripción...",text:"Debe digitar la descripción de la merma"}),listaok=!1),objlista.descripcion=$(item).find("td:eq(5) input").val(),merma.listaInsumo.push(objlista)}}),merma.listaProducto=[],$("#tProducto tbody tr").each(function(i,item){if("Sin Registros"!=$(item).find("td:eq(0)")[0].textContent){var objlista=new Object;objlista.idProducto=$(item).find("td:eq(0)")[0].textContent,objlista.costo=$(item).find("td:eq(3)")[0].textContent,objlista.cantidad=$(item).find("td:eq(4) input").val(),null!=$(item).find("td:eq(5) input").val()&&""==$(item).find("td:eq(5) input").val()&&(swal({type:"warning",title:"Descripción...",text:"Debe digitar la descripción de la merma"}),listaok=!1),objlista.descripcion=$(item).find("td:eq(5) input").val(),merma.listaProducto.push(objlista)}}),!!listaok&&(0==merma.listaInsumo.length&&0==merma.listaProducto.length?(swal({type:"warning",title:"Seleccionar...",text:"Debe seleccionar la materia prima o productos"}),!1):($("#btnMerma").attr("disabled","disabled"),void $.ajax({type:"POST",url:"class/merma.php",data:{action:"Create",obj:JSON.stringify(this)}}).done(function(){merma.showInfo(),ti.rows().remove().draw(),tp.rows().remove().draw()}).fail(function(e){insumo.showError(e)}).always(function(){$("#btnMerma").removeAttr("disabled"),$("#p_searhInsumo").focus()})))}}let merma=new Merma;var t;