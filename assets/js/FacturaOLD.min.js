class Factura{constructor(id,cajero,subTotal,descuento,producto,total,fechaCreacion,idfila,p_codigo,p_descripcion,p_precio,p_cantidad,importe){this.id=id||null,this.cajero=cajero||"",this.subTotal=subTotal||"",this.descuento=descuento||0,this.producto=producto||0,this.total=total||"",this.fechaCreacion=fechaCreacion||null,this.idfila=idfila||0,this.p_codigo=p_codigo||"",this.p_precio=p_precio||0,this.p_cantidad=p_cantidad||0,this.importe=importe||0}get Importe(){return this.cantidad*this.precio}}let factura=new Factura;function LoadProducto(){factura.p_codigo=$("#p_searh").val(),$.ajax({type:"POST",url:"class/Factura.php",data:{action:"LoadProducto",producto:JSON.stringify(factura)}}).done(function(e){CleanCtls(),showDataProducto(e)}).fail(function(e){showError(e)})}function showDataProducto(e){var data=JSON.parse(e);$.each(data,function(i,item){var opt='<tr class="even pointer"><td class="a-center "><div class="icheckbox_flat-green" style="position: relative;"><input type="checkbox" class="flat" name="table_records" style="position: absolute; opacity: 0;"><ins class="iCheck-helper" style="position: absolute; top: 0%; left: 0%; display: block; width: 100%; height: 100%; margin: 0px; padding: 0px; background: rgb(255, 255, 255); border: 0px; opacity: 0;"></ins></div></td><td class=" ">'+item.codigorapido+'</td><td class=" ">'+item.descripcion+'</td><td class=" " id="precio_'+item.codigorapido+'">¢'+item.precio+'</td><td class="">   <input class="cantidad form-control" type="number" min="1" max="9999" step="1"value="1" id="cant_'+item.codigorapido+'"></td><td id="importe_'+item.codigorapido+'">¢'+item.precio+"</td></tr>";$("#productos").append(opt)})}function LoadAll(){id=null,$.ajax({type:"POST",url:"../../class/Producto.php",data:{action:"LoadAll"}}).done(function(e){CleanCtls(),showData(e)}).fail(function(e){showError(e)})}function showInfo(){}function showError(e){var data=JSON.parse(e.responseText);alert("ERROR")}function showData(e){$("#tableBody-Producto").html("");var data=JSON.parse(e);$.each(data,function(i,item){var row="<tr><td>"+item.id+"</td><td>"+item.nombre+"</td><td>"+item.scancode+"</td><td>"+item.cantidad+"</td><td>"+item.precio+"</td><td>"+item.codigorapido+"</td><td><img id=btnmodingreso"+item.id+" src=img/file_mod.png></td><td><img id=btnborraingreso"+item.id+" src=img/file_delete.png></td></tr>";$("#tableBody-Producto").append(row),$("#btnmodingreso"+item.id).click(UpdateEventHandler),$("#btnborraingreso"+item.id).click(DeleteEventHandler)})}function showDataCategoria(e){var data=JSON.parse(e);$.each(data,function(i,item){var opt='<option value="'+item.id+'">'+item.nombre+"</option>";$("#categoria").append(opt)})}function UpdateEventHandler(){producto.id=$(this).parents("tr").find("td").eq(0).text(),$.ajax({type:"POST",url:"class/Producto.php",data:{action:"Load",producto:JSON.stringify(producto)}}).done(function(e){ShowItemData(e)}).fail(function(e){showError(e)})}function DeleteEventHandler(){producto.id=$(this).parents("tr").find("td").eq(0).text(),swal({title:"Eliminar?",text:"Esta acción es irreversible!",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",confirmButtonClass:"btn btn-success",cancelButtonClass:"btn btn-danger"}).then(function(){Delete()})}function Delete(){$.ajax({type:"POST",url:"class/Producto.php",data:{action:"Delete",producto:JSON.stringify(producto)}}).done(function(e){var data;1==JSON.parse(e).status?swal("Mensaje!","El registro se encuentra  en uso, no es posible eliminar.","error"):swal("Eliminado!","El registro se ha eliminado.","success")}).fail(function(e){showError(e)}).always(LoadAll)}function CleanCtls(){$("#p_searh").val("")}function ShowItemData(e){CleanCtls();var data=JSON.parse(e)[0];producto=new Producto(data.id,data.nombre,data.scancode,data.cantidad,data.precio,data.codigorapido,data.idcategoria,data.fechaExpiracion),$("#id").val(producto.id),$("#nombre").val(producto.nombre),$("#precio").val(producto.precio),$("#cantidad").val(producto.cantidad),$("#codigorapido").val(producto.codigorapido),$("#categoria").val(producto.idcategoria),$("#fechaExpiracion").val(producto.fechaExpiracion)}function Save(){var miAccion=null==producto.id?"Insert":"Update";producto.nombre=$("#nombre").val(),producto.cantidad=$("#cantidad").val(),producto.precio=$("#precio").val(),producto.codigorapido=$("#codigorapido").val(),producto.idcategoria=$("#categoria").val(),producto.fechaExpiracion=$("#fechaExpiracion").val(),$.ajax({type:"POST",url:"../../../class/Producto.php",data:{action:miAccion,producto:JSON.stringify(producto)}}).done(showInfo).fail(function(e){showError(e)}).always(function(){setTimeout('$("#btnProducto").removeAttr("disabled")',1500),LoadAll()})}$(document).ready(function(){Session.Check(),$("tbody tr").click(function(){$(".selected").removeClass("selected"),$(this).addClass("selected"),alert("si entra")}),$(".cantidad").change(function(){alert("entra")})}),$("#p_searh").keypress(function(e){13==e.which&&LoadProducto()});