class OrdenSalida{constructor(id,fecha,numeroOrden,idUsuarioEntrega,idUsuarioRecibe,fechaLiquida,estado,i,ic,tb_OrdenProduccion,fechaInicial,fechaFinal){this.id=id||null,this.numeroOrden=numeroOrden||"",this.fecha=fecha||"",this.idUsuarioEntrega=idUsuarioEntrega||"",this.idUsuarioRecibe=idUsuarioRecibe||"",this.fechaLiquida=fechaLiquida||"",this.estado=estado||0,this.listaInsumo=i||[],this.listaInsumoCantidad=ic||[],this.tb_OrdenProduccion=tb_OrdenProduccion||[],this.fechaInicial=fechaInicial||"",this.fechaFinal=fechaFinal||""}get Read(){var miAccion=null==this.id?"ReadAll":"Read";"ReadAll"==miAccion&&0==$("#tableBody-OrdenSalida").length||$.ajax({type:"POST",url:"class/OrdenSalida.php",data:{action:miAccion,id:this.id}}).done(function(e){ordenSalida.Reload(e)}).fail(function(e){ordenSalida.showError(e)})}get Save(){if(0!=$("#tableBody-InsumosOrdenSalida tr").length){$("#btnOrdenSalida").attr("disabled","disabled");var miAccion=null==this.id?"Create":"Update";this.fecha=$("#dt_fecha").val(),this.usuarioRecibe=usuario.id,this.estado=0,ordenSalida.listaInsumo=[],$("#tableBody-InsumosOrdenSalida tr").each(function(){var objInsumo=new Object;objInsumo.id=$(this).find("td:eq(0)").html(),objInsumo.nombreInsumo=$(this).find("td:eq(2)").html(),objInsumo.codigo=$(this).find("td:eq(1)").html(),objInsumo.cantidad=$(this).find("td:eq(7) input").val(),objInsumo.costoPromedio=$(this).find("td:eq(6)").html(),ordenSalida.listaInsumo.push(objInsumo)});var referenciaCircular=ordenSalida.tb_OrdenProduccion;ordenSalida.tb_OrdenProduccion=[],$.ajax({type:"POST",url:"class/OrdenSalida.php",data:{action:miAccion,obj:JSON.stringify(this)}}).done(function(e){ordenSalida.tb_OrdenProduccion=referenciaCircular,ordenSalida.showInfo(e)}).fail(function(e){ordenSalida.showError(e)}).always(function(){$("#btnOrdenSalida").removeAttr("disabled"),(ordenSalida=new OrdenSalida).ClearCtls(),ordenSalida.Read})}else swal({type:"info",title:"Debe agregar los Insumos de la Orden de Salida..."})}get ReadbyOrden(){$("#orden").attr("disabled","disabled");var miAccion="ReadbyOrden";this.numeroOrden=$("#p_searh").val(),$.ajax({type:"POST",url:"class/OrdenSalida.php",data:{action:miAccion,obj:JSON.stringify(this)}}).done(function(e){"null"==e?swal({type:"warning",title:"Orden no encontrada!",showConfirmButton:!1,timer:1e3}):ordenSalida.ShowItemData(e)}).fail(function(e){distr.showError(e)}).always(function(){$("#orden").removeAttr("disabled")})}get Delete(){1==liquidada?$.ajax({type:"POST",url:"class/ElaborarProducto.php",data:{action:"RevierteOrdenSalida",idOrdenSalida:ordenSalida.id}}).done(function(e){swal({type:"success",title:"Cancelado!",showConfirmButton:!1,timer:1e3})}).fail(function(e){}).always(function(){(ordenSalida=new OrdenSalida).Read}):$.ajax({type:"POST",url:"class/OrdenSalida.php",data:{action:"Delete",id:this.id}}).done(function(e){var data=JSON.parse(e);0==data?swal({type:"success",title:"Eliminado!",showConfirmButton:!1,timer:1e3}):1==data.status?swal({type:"error",title:"No es posible eliminar...",text:"El registro que intenta eliminar ya se ecnuentra liquidado"}):swal({type:"error",title:"Ha ocurrido un error...",text:"El registro no ha sido eliminado",footer:"<a href>Contacte a Soporte Técnico</a>"})}).fail(function(e){ordenSalida.showError(e)}).always(function(){(ordenSalida=new OrdenSalida).Read})}get RevertirOrdenSalida(){$.ajax({type:"POST",url:"class/ElaborarProducto.php",data:{action:"RevierteOrdenSalida",idOrdenSalida:this.id}}).done(function(e){alert("Prueba")}).fail(function(e){ordenSalida.showError(e)}).always(function(){(ordenSalida=new OrdenSalida).Read})}CargaOrdenProduccionRango(){var referenciaCircular=ordenSalida.tb_OrdenProduccion;ordenSalida.tb_OrdenProduccion=[],$.ajax({type:"POST",url:"class/OrdenSalida.php",data:{action:"ReadAllbyRange",obj:JSON.stringify(ordenSalida)}}).done(function(e){ordenSalida.tb_OrdenProduccion=referenciaCircular,ordenSalida.ShowAll(e)})}UpdateCantidadProducto(){productobodega.idProducto=$(this).parents("tr").find("td:eq(1)").html(),productobodega.cantidad=$(this).parents("tr").find("td:eq(5)").html(),productobodega.idBodega="22a80c9e-5639-11e8-8242-54ee75873a00";var idordensalida=$(this).parents("tr").find("td:eq(0)").html();productobodega.SaveCantidad(idordensalida)}Reload(e){null==this.id?this.ShowAll(e):this.ShowItemData(e)}showInfo(e){ordenSalida.ticketPrint(e)}ticketPrint(e){localStorage.setItem("lsNumeroOrden",e),localStorage.setItem("lsFechaOrdensalida",ordenSalida.fecha),localStorage.setItem("lsUsuarioRecibe",$("#nombre").val()),localStorage.setItem("lsListaInsumo",JSON.stringify(this.listaInsumo)),location.href="/TicketOrdenSalida.html"}ticketRePrint(){localStorage.setItem("lsNumeroOrden",$("#numeroOrden").val()),localStorage.setItem("lsFechaOrdensalida",$("#dt_fecha").val()),localStorage.setItem("lsUsuarioRecibe",$("#nombre").val()),localStorage.setItem("lsListaInsumo",JSON.stringify(ordenSalida.listaInsumo)),location.href="/TicketOrdenSalida.html"}showError(e){var data=JSON.parse(e.responseText);swal({type:"error",title:"Oops...",text:"Algo no está bien ("+data.code+"): "+data.msg,footer:"<a href>Contacte a Soporte Técnico</a>"})}ClearCtls(){$("#p_searh").val(""),$("#orden").val(""),$("#fecha").val(""),$("#usuarioEntrega").val(""),$("#usuarioRecibe").val(""),$("#tableBody-InsumosOrdenSalida").html("")}ShowAll(e){var t=$("#dsOrdenSalida").DataTable();0==t.rows().count()?(t.clear(),t.rows.add(JSON.parse(e)),t.draw(),$(document).on("click","#dsOrdenSalida tbody tr td:not(.buttons)",ordenSalida.UpdateEventHandler),$(document).on("click",".deleteOrdenSalida",ordenSalida.DeleteEventHandler)):(t.clear(),t.rows.add(JSON.parse(e)),t.draw())}setTableOrdenSalida(){this.tb_OrdenProduccion=$("#dsOrdenSalida").DataTable({responsive:!0,destroy:!0,order:[[0,"desc"]],dom:"Bfrtip",buttons:[{extend:"excelHtml5",exportOptions:{columns:[0,4,5,6,7,8]},messageTop:"Orden de Producción"},{extend:"pdfHtml5",messageTop:"Orden de Producción",exportOptions:{columns:[0,4,5,6,7,8]}}],language:{infoEmpty:"Sin Ordenes de Producción",emptyTable:"Sin Ordenes de Producción",search:"Buscar",zeroRecords:"No hay resultados",lengthMenu:"Mostrar _MENU_ registros",paginate:{first:"Primera",last:"Ultima",next:"Siguiente",previous:"Anterior"}},columns:[{title:"Orden",data:"numeroOrden"},{title:"ID",data:"id",className:"itemId"},{title:"ID USUARIO ENTREGA",data:"idUsuarioEntrega",visible:!1},{title:"ID USUARIO RECIBE",data:"idUsuarioRecibe",visible:!1},{title:"FECHA",data:"fecha"},{title:"ENTREGA",data:"usuarioEntrega"},{title:"RECIBE",data:"usuarioRecibe"},{title:"FECHA LIQUIDA",data:"fechaLiquida"},{title:"ESTADO",data:"idEstado",mRender:function(e){var estado="1";return"0"==e&&(estado="EN PROCESO"),"1"==e&&(estado="LIQUIDADO"),"2"==e&&(estado="CANCELADO"),estado}},{title:"ACCIÓN",class:"buttons",orderable:!1,searchable:!1,className:"buttons",mRender:function(){return'<a class="deleteOrdenSalida" style="cursor: pointer;" > <i class="glyphicon glyphicon-trash"> </i> </a>'}}]})}CompruebaCantidadInsumo(id){var cantidad=$("#cantidadInsumo"+id).find("td:eq(7) input").val();alert(cantidad)}AddTableInsumo(id,codigo,nombre,descripcion,saldoCantidad,saldoCosto,costoPromedio){var cant="1";if($("#tableBody-InsumosOrdenSalida").append(`\n            <tr id="row"${id}> \n                <td class="itemId" >${id}</td>\n                <td class=oculto>${codigo}</td>\n                <td>${nombre}</td>\n                <td class=oculto>${descripcion}</td>\n                <td class=oculto>${saldoCantidad}</td>\n                <td class=oculto>${saldoCosto}</td>\n                <td class=oculto>${costoPromedio}</td>\n                <td>\n                    <input id="cantidadInsumo${id}" class="form-control cantidadInsumo" name="cantidadInsumo" type="number" placeholder="Cantidad de paquetes" autofocus="" value=1>\n                </td>\n                <td class="last">\n                    <a id="delete_row${id}" class="btnDeleteItem" onclick="ordenSalida.DeleteInsumo(this)" > <i class="glyphicon glyphicon-trash" onclick="DeleteInsumo(this)"> </i> Eliminar </a>\n                </td>\n            </tr>\n        `),$.fn.dataTable.isDataTable("#dsInsumosOrdenSalida"))var table=$("#dsInsumosOrdenSalida").DataTable();else $("#dsInsumosOrdenSalida").DataTable({columns:[{width:"0px"},{width:"0px"},{width:"35%"},{width:"0px"},{width:"0px"},{width:"0px"},{width:"0px"},{width:"35%"},{width:"30%"}],scrollY:"300px",paging:!1,ordering:!1,info:!1,searching:!1,scrollCollapse:!0});$("#cantidadInsumo"+id).change(function(e){$("#btnOrdenSalida").attr("disabled",!0);var cantidad=$(this).val();$.ajax({type:"POST",url:"class/Insumo.php",data:{action:"saldoCorrecto",id:id,cantidad:cantidad}}).done(function(e){var cantidad=parseFloat(e);"true"!=e&&swal({type:"error",title:"El insumo no posee saldo suficiente...",text:"La cantidad de insumos disponibles es "+parseFloat(cantidad)}).then($("#cantidadInsumo"+id).val(cantidad)),$("#btnOrdenSalida").attr("disabled",!1)}).fail(function(e){}).always(function(){})})}DeleteInsumo(btn){var row=btn.parentNode.parentNode;row.parentNode.removeChild(row)}UpdateEventHandler(){$("#btnOrdenSalida").attr("disabled",!1),$("#btnAddUsuarioRecibe").attr("disabled",!1),$("#btnAddInsumo").attr("disabled",!1),ordenSalida.id=$(this).parents("tr").find(".itemId").text()||$(this).find(".itemId").text(),ordenSalida.Read,"LIQUIDADO"!=$(this).parents("tr").find("td:eq(6)").html()&&"CANCELADO"!=$(this).parents("tr").find("td:eq(6)").html()||swal({type:"info",title:"La orden ya ha sido liquidada, No se puede modificar..."}).then(function(){$("#btnOrdenSalida").attr("disabled",!0),$("#btnAddUsuarioRecibe").attr("disabled",!0),$("#btnAddInsumo").attr("disabled",!0),$(".btnDeleteItem").attr("disabled",!0),$(".form-control").attr("disabled",!0),$(".hidden").attr("visibility","hidden")})}ShowItemData(e){if(null==e&&-1!=document.URL.indexOf("ElaborarProducto.html"))$("p_searh").val(""),swal({type:"info",title:"La orden ya ha sido liquidada..."});else{this.ClearCtls();var data=JSON.parse(e);-1!=document.URL.indexOf("ElaborarProducto.html")&&(this.id=data.id,$.each(data.listaInsumo,function(i,item){if($("#tableBody-InsumosOrdenSalida").append(`\n                        <tr id="row"${item.id}> \n                            <td class="itemId" >${item.idInsumo}</td>\n                            <td class=oculto>${item.codigo}</td>\n                            <td>${item.nombreInsumo}</td>\n                            <td class=oculto>${item.descripcion}</td>\n                            <td class=oculto>${item.saldoCantidad}</td>\n                            <td class=oculto>${item.saldoCosto}</td>\n                            <td class=oculto>${item.costoPromedio}</td>\n                            <td>\n                                <input id="cantidadInsumo${item.id}" class="form-control col-3" name="cantidadInsumo" type="number" placeholder="Cantidad de paquetes" autofocus="" value="${item.cantidad}"readonly>\n                            </td>\n                        </tr>\n                    `),$.fn.dataTable.isDataTable("#dsInsumosOrdenSalida"))var table=$("#dsInsumosOrdenSalida").DataTable();else $("#dsInsumosOrdenSalida").DataTable({columns:[{width:"0px"},{width:"0px"},{width:"50%"},{width:"0px"},{width:"0px"},{width:"0px"},{width:"0px"},{width:"50%"}],paging:!1,ordering:!1,info:!1,searching:!1})}),$("#orden").val(data.numeroOrden),$("#fecha").val(data.fecha),$("#usuarioEntrega").val(data.usuarioEntrega),$("#usuarioRecibe").val(data.usuarioRecibe),0==ordenSalida.idEstado?$('#estado option:contains("EN PROCESO")'):$('#estado option:contains("LIQUIDADO")')),-1!=document.URL.indexOf("InventarioOrdenSalida.html")&&($(".bs-example-modal-lg").modal(),$.each(data.listaInsumo,function(i,item){if($("#tableBody-InsumosOrdenSalida").append(`\n                        <tr id="row"${item.id}> \n                            <td class="itemId">${item.idInsumo}</td>\n                            <td class=oculto>${item.codigo}</td>\n                            <td>${item.nombreInsumo}</td>\n                            <td class=oculto>${item.descripcion}</td>\n                            <td class=oculto>${item.saldoCantidad}</td>\n                            <td class=oculto>${item.saldoCosto}</td>\n                            <td class=oculto>${item.costoPromedio}</td>\n                            <td>\n                                <input id="cantidadInsumo2${item.id}" class="form-control col-3" name="cantidadInsumo" type="text" placeholder="Cantidad de paquetes" autofocus="" value="${item.cantidad}">\n                            </td>\n                            <td class=" last">\n                                <a id="delete_row${item.id}" class="btnDeleteItem" onclick="ordenSalida.DeleteInsumo(this)" > <i class="glyphicon glyphicon-trash" onclick="DeleteInsumo(this)"> </i> Eliminar </a>\n                            </td>\n                        </tr>\n                    `),$("#cantidadInsumo2"+item.id).change(function(e){$("#btnOrdenSalida").attr("disabled",!0);var cantidad=$(this).val(),cantidadtemporal=parseFloat(item.cantidad);$.ajax({type:"POST",url:"class/Insumo.php",data:{action:"saldoCorrectoMod",id:item.idInsumo,cantidad:cantidad,scant:item.cantidad}}).done(function(e){var cantidad=parseFloat(e);"true"!=e&&swal({type:"error",title:"El insumo no posee saldo suficiente...",text:"La cantidad maxima de insumos disponibles es "+parseFloat(cantidad+cantidadtemporal)}).then($("#cantidadInsumo2"+item.id).val(cantidad+cantidadtemporal)),cantidadtemporal=0,$("#btnOrdenSalida").attr("disabled",!1)}).fail(function(e){}).always(function(){})}),$.fn.dataTable.isDataTable("#dsInsumosOrdenSalida"))var table=$("#dsInsumosOrdenSalida").DataTable();else $("#dsInsumosOrdenSalida").DataTable({columns:[{width:"0px"},{width:"0px"},{width:"35%"},{width:"0px"},{width:"0px"},{width:"0px"},{width:"0px"},{width:"35%"},{width:"30%"}],paging:!1,ordering:!1,info:!1,searching:!1})}),this.id=data.id,this.idUsuarioEntrega=data.idUsuarioEntrega,this.idUsuarioRecibe=data.idUsuarioRecibe,usuario.id=data.idUsuarioRecibe,this.listaInsumo=data.listaInsumo,$("#numeroOrden").val(data.numeroOrden),$("#dt_fecha").val(data.fecha),$("#nombre").val(data.usuarioRecibe),ordenSalida.listaInsumoCantidad=[],$("#tableBody-InsumosOrdenSalida tr").each(function(){var objInsumo=new Object;objInsumo.id=$(this).find("td:eq(0)").html(),objInsumo.cantidad=$(this).find("td:eq(7) input").val(),ordenSalida.listaInsumoCantidad.push(objInsumo)}))}}DeleteEventHandler(){ordenSalida.id=$(this).parents("tr").find(".itemId").text(),"CANCELADO"==$(this).parents("tr").find("td:eq(6)").html()?swal({type:"info",title:"La orden ha sido cancelada y se encuentra inactiva!"}):swal({title:"Eliminar?",text:"Esta acción es irreversible!",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",confirmButtonClass:"btn btn-success",cancelButtonClass:"btn btn-danger"}).then(result=>{result.value&&(liquidada=!1,"LIQUIDADO"==$(this).parents("tr").find("td:eq(6)").html()&&(liquidada=!0),ordenSalida.Delete)})}AddUserEventHandler(){$("#usuarioRecibe").val($(this).parents("tr").find("td:eq(2)").html()),ordenSalida.idUsuarioRecibe=$(this).parents("tr").find("td:eq(1)").html(),$("#modal-usuarioRecibe").modal("toggle"),$("#estado").focus()}AddInsumoEventHandler(id,codigo,nombre,descripcion,saldoCantidad,saldoCosto,costoPromedio){var ids_insumos=[];$("#tableBody-InsumosOrdenSalida tr").each(function(){ids_insumos.push($(this).find("td:eq(0)").html())}),0==ids_insumos.length?ordenSalida.AddTableInsumo(id,codigo,nombre,descripcion,saldoCantidad,saldoCosto,costoPromedio):-1!=ids_insumos.indexOf(id)?$("#chk-addinsumo"+id).attr("checked",!1):ordenSalida.AddTableInsumo(id,codigo,nombre,descripcion,saldoCantidad,saldoCosto,costoPromedio)}Init(){var validator=new FormValidator({events:["blur","input","change"]},document.forms[0][0]);$("#frmOrdenSalida").submit(function(e){var validatorResult;return e.preventDefault(),validator.checkAll(this).valid&&ordenSalida.Save,!1}),$("#frmInventarioOrdenSalida").submit(function(e){var validatorResult;return e.preventDefault(),validator.checkAll(this).valid&&ordenSalida.Save,!1}),$("#frmInventarioProductoTemporal").submit(function(e){var validatorResult;return e.preventDefault(),validator.checkAll(this).valid&&ordenSalida.Save,!1}),document.forms[0].onreset=function(e){validator.reset()}}}var liquidada=!1;let ordenSalida=new OrdenSalida;