class ProductoTemporal{constructor(id,idproducto,producto,idusuario,idusuariorecibe,usuario,usuariorecibe,cantidad,estado,i){this.id=id||null,this.idproducto=idproducto||"",this.producto=producto||"",this.idusuario=idusuario||"",this.idusuariorecibe=idusuariorecibe||"",this.usuario=usuario||"",this.usuariorecibe=usuariorecibe||"",this.cantidad=cantidad||0,this.estado=estado||0,this.listainsumo=i||[]}get Read(){var miAccion=null==this.id?"ReadAll":"Read";"ReadAll"==miAccion&&0==$("#tableBody-ProductoTemporal").length||$.ajax({type:"POST",url:"class/ProductoTemporal.php",data:{action:miAccion,id:this.id}}).done(function(e){productotemporal.Reload(e)}).fail(function(e){productotemporal.showError(e)})}get Save(){if(0!=$("#tableBody-InsumoProducto tr").length){$("#btnProductoTemporal").attr("disabled","disabled");var miAccion=null==this.id?"Create":"Update";this.idproducto=productotemporal.idproducto,this.cantidad=$("#cantidad").val(),this.estado=0,this.idusuariorecibe=productotemporal.idusuariorecibe,productotemporal.listainsumo=[],$("#tableBody-InsumoProducto tr").each(function(){var objInsumo=new Object;objInsumo.id=$(this).find("td:eq(0)").html(),objInsumo.cantidad=$(this).find("td:eq(2) input").val(),objInsumo.costo=$(this).find("td:eq(3)").html(),productotemporal.listainsumo.push(objInsumo)}),$.ajax({type:"POST",url:"class/ProductoTemporal.php",data:{action:miAccion,obj:JSON.stringify(this)}}).done(productotemporal.showInfo).fail(function(e){productotemporal.showError(e)}).always(function(){setTimeout('$("#btnProductoTemporal").removeAttr("disabled")',1e3),(productotemporal=new ProductoTemporal).ClearCtls(),productotemporal.Read})}else swal({type:"info",title:"Debe agregar los Insumos del Producto..."})}get Delete(){$.ajax({type:"POST",url:"class/ProductoTemporal.php",data:{action:"Delete",id:this.id}}).done(function(){var data=JSON.parse(e);0==data.status?swal({type:"success",title:"Eliminado!",showConfirmButton:!1,timer:1e3}):1==data.status?swal({type:"error",title:"No es posible eliminar...",text:"El registro que intenta eliminar tiene objetos relacionados"}):swal({type:"error",title:"Ha ocurrido un error...",text:"El registro no ha sido eliminado",footer:"<a href>Contacte a Soporte Técnico</a>"})}).fail(function(e){productotemporal.showError(e)}).always(function(){(productotemporal=new ProductoTemporal).Read})}UpdateCantidadProducto(){productobodega.idproducto=$(this).parents("tr").find("td:eq(1)").html(),productobodega.cantidad=$(this).parents("tr").find("td:eq(5)").html(),productobodega.idbodega="22a80c9e-5639-11e8-8242-54ee75873a00";var idproductotemporal=$(this).parents("tr").find("td:eq(0)").html();productobodega.SaveCantidad(idproductotemporal)}Reload(e){null==this.id?this.ShowAll(e):this.ShowItemData(e)}showInfo(){$(".close").click(),swal({position:"top-end",type:"success",title:"Listo!",showConfirmButton:!1,timer:1e3})}showError(e){var data=JSON.parse(e.responseText);swal({type:"error",title:"Oops...",text:"Algo no está bien ("+data.code+"): "+data.msg,footer:"<a href>Contacte a Soporte Técnico</a>"})}ClearCtls(){$("#cantidad").val(""),$("#nombre").val(""),$("#tableBody-InsumoProducto").html("")}ShowAll(e){$("#tableBody-ProductoTemporal").html("");var data=JSON.parse(e),estado="EN PROCESO";if($.each(data,function(i,item){estado="0"==item.estado?"EN PROCESO":"TERMINADO",$("#tableBody-ProductoTemporal").append(`\n                <tr> \n                    <td class="itemId">${item.id}</td>\n                    <td class="oculto">${item.idproducto}</td>\n                    <td class="oculto">${item.idusuario}</td>\n                    <td class="oculto">${item.idusuariorecibe}</td>\n                    <td>${item.producto}</td>\n                    <td>${item.usuario}</td>\n                    <td>${item.usuariorecibe}</td>\n                    <td>${item.cantidad}</td>\n                    <td>${estado}</td>\n                    <td class=" last">\n                        <a id="update${item.id}" class="update" data-toggle="modal" data-target=".bs-example-modal-lg" > <i class="glyphicon glyphicon-edit" > </i> Editar </a> | \n                        <a id="delete${item.id}" class="delete"> <i class="glyphicon glyphicon-trash"> </i> Eliminar </a>\n                    </td>\n                    <td class="a-center ">\n                    <input id="chkterminado${item.id}" type="checkbox" class="flat" name="table_records">\n                </td>\n                </tr>\n            `),$("#update"+item.id).click(productotemporal.UpdateEventHandler),$("#delete"+item.id).click(productotemporal.DeleteEventHandler),$("#chkterminado"+item.id).click(productotemporal.UpdateCantidadProducto)}),$.fn.dataTable.isDataTable("#dsProductoTemporal"))var table=$("#dsProductoTemporal").DataTable();else $("#dsProductoTemporal").DataTable()}AddTableInsumo(id,nombre,costo){if($("#tableBody-InsumoProducto").append(`\n            <tr id="row"${id}> \n                <td class="itemId" >${id}</td>\n                <td>${nombre}</td>\n                <td>\n                    <input id="cantidadInsumo" class="form-control col-3" name="cantidadInsumo" type="text" placeholder="Cantidad de paquetes" autofocus="" value="1">\n                </td>\n                <td class=oculto>${costo}</td>\n                <td class=" last">\n                    <a id ="delete_row${id}" onclick="productotemporal.DeleteInsumo(this)" > <i class="glyphicon glyphicon-trash" onclick="DeleteInsumo(this)"> </i> Eliminar </a>\n                </td>\n            </tr>\n        `),$.fn.dataTable.isDataTable("#dsProductoTemporal"))var table=$("#dsProductoTemporal").DataTable();else $("#dsProductoTemporal").DataTable({columns:[{width:"35%"},{width:"35%"},{width:"33%"}],paging:!0,search:!0})}DeleteInsumo(btn){var row=btn.parentNode.parentNode;row.parentNode.removeChild(row)}UpdateEventHandler(){productotemporal.id=$(this).parents("tr").find(".itemId").text(),productotemporal.Read}ShowItemData(e){this.ClearCtls();var data=JSON.parse(e);productotemporal=new ProductoTemporal(data.id,data.idproducto,data.producto,data.idusuario,data.idusuariorecibe,data.usuario,data.usuariorecibe,data.cantidad,data.estado,data.listainsumo),$.each(data.listainsumo,function(i,item){if($("#tableBody-InsumoProducto").append(`\n                <tr id="row"${item.idinsumo}> \n                    <td class="itemId" >${item.idinsumo}</td>\n                    <td>${item.nombre}</td>\n                    <td>\n                        <input id="cantidadInsumo" class="form-control col-3" name="cantidadInsumo" type="text" placeholder="${item.cantidad}" autofocus="" value="1">\n                    </td>\n                    <td class=" last">\n                        <a id ="delete_row${item.id}" onclick="productotemporal.DeleteInsumo(this)" > <i class="glyphicon glyphicon-trash" onclick="DeleteInsumo(this)"> </i> Eliminar </a>\n                    </td>\n                </tr>\n            `),$.fn.dataTable.isDataTable("#dsProductoTemporal"))var table=$("#dsProductoTemporal").DataTable();else $("#dsProductoTemporal").DataTable({columns:[{width:"35%"},{width:"35%"},{width:"33%"}],paging:!0,search:!0})}),$("#nombre").val(productotemporal.producto),$("#cantidad").val(productotemporal.cantidad),$("#usuariorecibe").val(productotemporal.usuariorecibe)}DeleteEventHandler(){productotemporal.id=$(this).parents("tr").find(".itemId").text(),swal({title:"Eliminar?",text:"Esta acción es irreversible!",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",confirmButtonClass:"btn btn-success",cancelButtonClass:"btn btn-danger"}).then(result=>{result.value&&productotemporal.Delete})}AddUserEventHandler(){$("#usuariorecibe").val($(this).parents("tr").find("td:eq(2)").html()),productotemporal.idusuariorecibe=$(this).parents("tr").find("td:eq(1)").html(),$("#modal-usuariorecibe").modal("toggle"),$("#cantidad").focus()}AddProductoEventHandler(){$("#nombre").val($(this).parents("tr").find("td:eq(2)").html()),productotemporal.idproducto=$(this).parents("tr").find("td:eq(1)").html(),$("#modal-producto").modal("toggle"),$("#cantidad").focus()}AddInsumoEventHandler(){var id=$(this).parents("tr").find("td:eq(1)").html(),nombre=$(this).parents("tr").find("td:eq(2)").html(),costo=$(this).parents("tr").find("td:eq(6)").html(),ids_indumos=[];$(this).is(":checked")&&($("#tableBody-InsumoProducto tr").each(function(){ids_indumos.push($(this).find("td:eq(0)").html())}),0==ids_indumos.length?productotemporal.AddTableInsumo(id,nombre,costo):-1!=ids_indumos.indexOf(id)?$("#chk-addinsumo"+id).attr("checked",!1):productotemporal.AddTableInsumo(id,nombre,costo))}Init(){var validator=new FormValidator({events:["blur","input","change"]},document.forms[0][0]);$("#frmProductoTemporal").submit(function(e){var validatorResult;return e.preventDefault(),validator.checkAll(this).valid&&productotemporal.Save,!1}),$("#frmInventarioProductoTemporal").submit(function(e){var validatorResult;return e.preventDefault(),validator.checkAll(this).valid&&productotemporal.Save,!1}),document.forms[0].onreset=function(e){validator.reset()}}}let productotemporal=new ProductoTemporal;