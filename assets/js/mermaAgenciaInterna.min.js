class MermaAgencia{constructor(id,idItem,cantidad,descripcion,fecha,idBodega,fechaInicial,fechaFinal){this.id=id||null,this.idBodega=idBodega||null,this.idItem=idItem||null,this.cantidad=cantidad||0,this.descripcion=descripcion||"",this.fecha=fecha||null,this.fechaInicial=fechaInicial||"",this.fechaFinal=fechaFinal||""}get Read(){NProgress.start();var miAccion=null==this.id?"ReadCompleto":"Read";"ReadAll"==miAccion&&0==$("#tMerma tbody").length||$.ajax({type:"POST",url:"class/mermaAgencia.php",data:{action:miAccion,id:this.id}}).done(function(e){merma.Reload(e)}).fail(function(e){merma.showError(e)}).always(NProgress.done())}get ReadBodegas(){var miAccion="ReadAll";$.ajax({type:"POST",url:"class/Bodega.php",data:{action:miAccion}}).done(function(e){merma.ShowList(e,$("#idBodega"))}).fail(function(e){merma.showError(e)})}ShowList(e,selector){if("[]"!=e){var data=JSON.parse(e);selector.html(""),$.each(data,function(i,item){selector.append(`\n                    <option value=${item.id} ${0==i?"selected":""} >${item.nombre}</option>\n                `)}),selector.selectpicker("refresh")}else swal({type:"error",title:"Oops...",text:"Algo no está bien, La lista no puede ser cargada"})}showError(e){var data=JSON.parse(e.responseText);swal({type:"error",title:"Oops...",text:"Algo no está bien ("+data.code+"): "+data.msg,footer:"<a href>Contacte a Soporte Técnico</a>"})}DeleteMerma(e){swal({title:"Devolver Merma de Agencia?",text:"Esta acción es irreversible!",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",confirmButtonClass:"btn btn-success",cancelButtonClass:"btn btn-danger"}).then(result=>{result.value&&(merma.id=$(e).parents("tr").find("td:eq(0)").text(),merma.idInsumo=$(e).parents("tr").find("td:eq(1)").text(),merma.consecutivo=$(e).parents("tr").find("td:eq(4)").text(),merma.cantidad=$(e).parents("tr").find("td:eq(7)").text(),$.ajax({type:"POST",url:"class/mermaAgencia.php",data:{action:"rollback",id:merma.id,idInsumo:merma.idInsumo,consecutivo:merma.consecutivo,cantidad:merma.cantidad}}).done(function(){merma.showInfo(),t.row($(e).parents("tr")).remove().draw()}).fail(function(e){merma.showError(e)}).always(function(){}))})}setTable(buttons=!0,nPaging=10){t=$("#tMerma").DataTable({responsive:!0,destroy:!0,order:[[2,"asc"]],dom:"Bfrtip",buttons:[{extend:"excelHtml5",exportOptions:{columns:[2,3,4,5,6,7,8,9]},messageTop:"Merma Agencia Interna"},{extend:"pdfHtml5",orientation:"landscape",messageTop:"Merma Agencia Interna",exportOptions:{columns:[2,3,4,5,6,7,8,9]}}],language:{infoEmpty:"Sin Registros de Mermas",emptyTable:"Sin Registros de Mermas",search:"Buscar",zeroRecords:"No hay resultados",lengthMenu:"Mostrar _MENU_ registros",paginate:{first:"Primera",last:"Ultima",next:"Siguiente",previous:"Anterior"}},columns:[{title:"ID",data:"id",className:"itemId",searchable:!1},{title:"IdInsumo",data:"idInsumo",className:"itemId",searchable:!1,width:"auto"},{title:"AGENCIA",data:"agencia",width:"auto"},{title:"CODIGO",data:"codigo"},{title:"CONSECUTIVO",data:"consecutivo"},{title:"NOMBRE",data:"nombre"},{title:"DESCRIPCION",data:"descripcion"},{title:"CANTIDAD",data:"cantidad"},{title:"OBSERVACIONES",data:"descripcion"},{title:"FECHA",data:"fecha"},{title:"Acción",orderable:!1,searchable:!1,mRender:function(){return'<a class="delete" style="cursor: pointer;" onclick="merma.DeleteMerma(this)" > <i class="glyphicon glyphicon-trash"> </i></a>'},visible:!0}]})}Reload(e){null==this.id?this.ShowAll(e):this.ShowItemData(e)}ShowAll(e){var t=$("#tMerma").DataTable();t.clear(),t.rows.add(JSON.parse(e)),$("td:eq(5)").attr({align:"right"}),t.order([1,"desc"]).draw()}CargaListaMermaInternaRango(){$.ajax({type:"POST",url:"class/mermaAgencia.php",data:{action:"ReadAllbyRangeInterna",obj:JSON.stringify(merma)}}).done(function(e){merma.ShowAll(e)})}CargaMermaRango(){var referenciaCircular=producto.tablainsumo;producto.tablainsumo=[],$.ajax({type:"POST",url:"class/Producto.php",data:{action:"ReadAllbyRange",obj:JSON.stringify(producto)}}).done(function(e){producto.tablainsumo=referenciaCircular,producto.ShowAllInventario(e)})}showInfo(){swal({type:"success",title:"Listo!",showConfirmButton:!1,timer:1e3})}crear(){swal({title:"Reversar a Central",text:"Desea Ingresar los productos a la Agencia Central despuúes de Aplicar la Merma?",type:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Solo aplicar merma",cancelButtonText:"Si, Cargar Inventario"}).then(result=>{result.value?this.sendMerma(!1):this.sendMerma(!0)})}sendMerma(cargaCentral){var miAccion="Create",listaok=!0;return merma.listaProducto=[],$("#tProducto tbody tr").each(function(i,item){var objlista=new Object;objlista.id=$(item).find("td:eq(0)")[0].textContent,objlista.cantidad=$(item).find("td:eq(4) input").val(),null!=$(item).find("td:eq(5) input").val()&&""==$(item).find("td:eq(5) input").val()&&(swal({type:"warning",title:"Descripción...",text:"Debe digitar la descripción de la merma"}),listaok=!1),objlista.descripcion=$(item).find("td:eq(5) input").val(),objlista.costoPromedio=$(item).find("td:eq(3)").html(),objlista.idProducto=$(item).find("td:eq(7)").html(),merma.listaProducto.push(objlista)}),!!listaok&&("Sin Registros"==merma.listaProducto[0].idProducto&&(merma.listaProducto=[]),0==merma.listaProducto.length?(swal({type:"warning",title:"Seleccionar...",text:"Debe seleccionar los productos."}),!1):($("#btnMerma").attr("disabled","disabled"),void $.ajax({type:"POST",url:"class/mermaAgencia.php",data:{action:"Create",obj:JSON.stringify(this),cargaCentral:cargaCentral}}).done(function(){merma.showInfo(),tp.rows().remove().draw()}).fail(function(e){producto.showError(e)}).always(function(){$("#btnMerma").removeAttr("disabled"),$("#p_searhProducto").focus()})))}ReadbyCodeAgencia(cod){""!=cod&&(producto=new Producto,producto.codigo=cod,merma.idBodega=$("#idBodega option:selected").val(),$.ajax({type:"POST",url:"class/InsumosXBodega.php",data:{action:"ReadByCode",idBodega:merma.idBodega,codigo:producto.codigo}}).done(function(e){merma.ValidatePrdMerma(e)}).fail(function(e){merma.showError(e)}))}ValidatePrdMerma(e){if("[]"!=e&&"false"!=e){if("false"!=e&&""!=e){var data=JSON.parse(e)[0];producto.id=data.id,producto.idProducto=data.idProducto,producto.codigo=data.codigo,producto.nombre=data.nombre,producto.descripcion=data.descripcion,producto.saldoCantidad=data.saldoCantidad,producto.costoPromedio=data.costoPromedio;var repetido=!1;0!=document.getElementById("tProducto").rows.length&&null!=producto&&$(document.getElementById("tProducto").rows).each(function(i,item){item.childNodes[0].innerText==producto.id&&(repetido=!0,swal({type:"warning",title:"Orden de Compra",text:"El item "+producto.codigo+" ya se encuentra en la lista",showConfirmButton:!1,timer:3e3}))}),0==repetido&&(producto.agregarItem(),$("#p_searhProducto").val(""))}}else swal({type:"warning",title:"Orden de Compra",text:"El item "+producto.codigo+" No existe.",showConfirmButton:!1,timer:3e3})}agregarItem(){if(producto.saldoCantidad<=0)return swal({type:"warning",title:"Merma",text:"El item "+producto.codigo+" no tiene cantidad disponible.",showConfirmButton:!1,timer:3e3}),!1;var rowNode=tp.row.add(producto).draw().node();$("td:eq(3) input",rowNode).attr({id:producto.codigo,max:producto.saldoCantidad,min:"1",step:"1",value:"1"}).change(function(){parseFloat(this.value)>parseFloat(this.max)&&(swal({type:"warning",title:"Merma",text:"La Cantidad a RESTAR del item "+this.id+" no puede ser superior cantidad disponible en Inventario.",showConfirmButton:!1,timer:3e3}),this.value=this.max)})}}let merma=new MermaAgencia;var t;