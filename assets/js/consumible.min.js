class Consumible{constructor(id,idProducto,cantidad,tamano){this.id=id||null,this.idProducto=idProducto||null,this.cantidad=cantidad||0,this.tamano=tamano||0}read(){NProgress.start();var miAccion=null==this.id?"ReadAll":"Read";"ReadAll"==miAccion&&0==$("#tConsumible8 tbody").length||$.ajax({type:"POST",url:"class/consumible.php",data:{action:miAccion,id:this.id}}).done(function(e){consumible.Reload(e)}).fail(function(e){consumible.showError(e)}).always(NProgress.done())}ReadProdbyCode(cod){""!=cod&&(producto.codigo=cod,$.ajax({type:"POST",url:"class/consumible.php",data:{action:"ReadByCode",obj:JSON.stringify(producto)}}).done(function(e){consumible.ValidatePrd(e)}).fail(function(e){consumible.showError(e)}))}ValidatePrd(e){if("[]"!=e){if("false"!=e&&""!=e){var data=JSON.parse(e)[0];producto.id=data.id,producto.idProducto=data.idProducto,producto.codigo=data.codigo,producto.nombre=data.nombre,producto.cantidad=1;var repetido=!1,tam=0;tam=0==producto.tamano?8:12,0!=document.getElementById("tConsumible"+tam).rows.length&&null!=producto&&$(document.getElementById("tConsumible"+tam).rows).each(function(i,item){"Sin Registros"!=item.innerText&&item.childNodes[1].innerText==producto.idProducto&&(repetido=!0,swal({type:"warning",title:"Consumibles",text:"El item "+producto.codigo+" ya se encuentra en la lista",showConfirmButton:!1,timer:3e3}))}),0==repetido&&(consumible.agregarItem(),$("#p_searhProducto8").val(""),$("#p_searhProducto12").val(""))}}else swal({type:"warning",title:"Consumibles",text:"El item "+producto.codigo+" No existe.",showConfirmButton:!1,timer:3e3})}agregarItem(){if(0==producto.tamano){var rowNode=t8.row.add(producto).draw().node();$("td:eq(4) input",rowNode).attr({id:producto.codigo,min:"1",step:"1",value:producto.cantidad})}else{var rowNode=t12.row.add(producto).draw().node();$("td:eq(4) input",rowNode).attr({id:producto.codigo,min:"1",step:"1",value:producto.cantidad})}}Reload(e){null==this.id?this.ShowAll(e):this.ShowItemData(e)}ShowAll(e){t8.clear(),t12.clear();var data=JSON.parse(e);$.each(data,function(i,item){producto=item,consumible.agregarItem()})}showError(e){var data=JSON.parse(e.responseText);swal({type:"error",title:"Oops...",text:"Algo no está bien ("+data.code+"): "+data.msg,footer:"<a href>Contacte a Soporte Técnico</a>"})}showInfo(){swal({type:"success",title:"Listo!",showConfirmButton:!1,timer:1e3})}crear(){var miAccion="Create";if(consumible.lista=[],$("#tConsumible8 tbody tr").each(function(i,item){var objlista=new Object;objlista.id=$(item).find("td:eq(0)")[0].textContent,objlista.idProducto=$(item).find("td:eq(1)")[0].textContent,objlista.cantidad=$(item).find("td:eq(4) input").val(),objlista.tamano=0,consumible.lista.push(objlista)}),$("#tConsumible12 tbody tr").each(function(i,item){var objlista=new Object;objlista.id=$(item).find("td:eq(0)")[0].textContent,objlista.idProducto=$(item).find("td:eq(1)")[0].textContent,objlista.cantidad=$(item).find("td:eq(4) input").val(),objlista.tamano=1,consumible.lista.push(objlista)}),"Sin Registros"==consumible.lista[0].idProducto)return swal({type:"warning",title:"Seleccionar...",text:"Debe seleccionar los productos consumibles"}),!1;$("#btnConsumible").attr("disabled","disabled"),$.ajax({type:"POST",url:"class/consumible.php",data:{action:"Create",obj:JSON.stringify(this)}}).done(function(){consumible.showInfo(),consumible.read()}).fail(function(e){consumible.showError(e)}).always(function(){$("#btnConsumible").removeAttr("disabled"),$("#p_searhProducto8").focus()})}Deleteproducto8(e){swal({title:"Eliminar?",text:"Esta acción es irreversible!",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",confirmButtonClass:"btn btn-success",cancelButtonClass:"btn btn-danger"}).then(result=>{result.value&&t8.row($(e).parents("tr")).remove().draw()})}Deleteproducto12(e){swal({title:"Eliminar?",text:"Esta acción es irreversible!",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",confirmButtonClass:"btn btn-success",cancelButtonClass:"btn btn-danger"}).then(result=>{result.value&&t12.row($(e).parents("tr")).remove().draw()})}setTable(){t8=$("#tConsumible8").DataTable({responsive:!0,destroy:!0,order:[[1,"asc"]],language:{infoEmpty:"Sin Registros",emptyTable:"Sin Registros",search:"Buscar",zeroRecords:"No hay resultados",lengthMenu:"Mostrar _MENU_ registros",paginate:{first:"Primera",last:"Ultima",next:"Siguiente",previous:"Anterior"}},columnDefs:[{className:"text-right",targets:[4]}],columns:[{title:"ID",data:"id",className:"itemId",searchable:!1,width:"auto"},{title:"IDPRODUCTO",data:"idProducto",className:"itemId",searchable:!1,width:"auto"},{title:"CODIGO",data:"codigo",width:"auto"},{title:"PRODUCTO",data:"nombre",width:"auto"},{title:"CANTIDAD",width:"15%",data:"cantidad",mRender:function(){return'<input class="cantidad form-control" type="number" min="1" max="9999999999" step="1" style="text-align:right;" >'}},{title:"ACCION",orderable:!1,searchable:!1,mRender:function(){return'<a class="delete" style="cursor: pointer;" onclick="consumible.Deleteproducto8(this)" > <i class="glyphicon glyphicon-trash"> </i></a>'},visible:!0}]}),t12=$("#tConsumible12").DataTable({responsive:!0,destroy:!0,order:[[1,"asc"]],language:{infoEmpty:"Sin Registros",emptyTable:"Sin Registros",search:"Buscar",zeroRecords:"No hay resultados",lengthMenu:"Mostrar _MENU_ registros",paginate:{first:"Primera",last:"Ultima",next:"Siguiente",previous:"Anterior"}},columnDefs:[{className:"text-right",targets:[4]}],columns:[{title:"ID",data:"id",className:"itemId",searchable:!1,width:"auto"},{title:"IDPRODUCTO",data:"idProducto",className:"itemId",searchable:!1,width:"auto"},{title:"CODIGO",data:"codigo",width:"auto"},{title:"PRODUCTO",data:"nombre",width:"auto"},{title:"CANTIDAD",width:"15%",data:"cantidad",mRender:function(){return'<input class="cantidad form-control" type="number" min="1" max="9999999999" step="1" style="text-align:right;" >'}},{title:"ACCION",orderable:!1,searchable:!1,mRender:function(){return'<a class="delete" style="cursor: pointer;" onclick="consumible.Deleteproducto12(this)" > <i class="glyphicon glyphicon-trash"> </i></a>'},visible:!0}]})}}let consumible=new Consumible;var t8=null,t12=null;