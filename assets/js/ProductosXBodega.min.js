class ProductoBodega{constructor(id,idBodega,precioVenta,lista){this.id=id||null,this.idBodega=idBodega||"",this.precioVenta=precioVenta||0,this.lista=lista||[]}get tUpdate(){return this.update="update"}get tSelect(){return this.select="select"}set viewEventHandler(_t){this.viewType=_t}get Read(){var miAccion=null==this.id?"ReadAll":"Read";"ReadAll"==miAccion&&0==$("#tDeterminacion tbody").length||$.ajax({type:"POST",url:"class/ProductosXBodega.php",data:{action:miAccion,id:this.id}}).done(function(e){productobodega.Reload(e)}).fail(function(e){productobodega.showError(e)})}get Save(){$("#btnProductosXBodega").attr("disabled","disabled");var miAccion=null==this.id?"Create":"Update";this.cantidad=$("#cantidad").val(),this.costo=$("#costo").val(),$.ajax({type:"POST",url:"class/ProductosXBodega.php",data:{action:miAccion,obj:JSON.stringify(this)}}).done(productobodega.showInfo).fail(function(e){productobodega.showError(e)}).always(function(){setTimeout('$("#btnProductosXBodega").removeAttr("disabled")',1e3),(productobodega=new ProductoBodega).ClearCtls(),productobodega.Read,productobodega.LimpiaLista()})}get Add(){$("#btnProductosXBodega").attr("disabled","disabled");var miAccion="Add";productobodega.lista=[],$("#tableBody-listaProducto tr").each(function(){var objlista=new Object;objlista.idBodega=bodega.id,objlista.id=$(this).find("td:eq(0)").html(),objlista.idProducto=$(this).find("td:eq(1)").html(),objlista.cantidad=$(this).find("td:eq(3) input").val(),objlista.costo=$(this).find("td:eq(4) input").val(),productobodega.lista.push(objlista)}),$.ajax({type:"POST",url:"class/ProductosXBodega.php",data:{action:"Add",obj:JSON.stringify(this)}}).done(productobodega.showInfo).fail(function(e){productobodega.showError(e)}).always(function(){setTimeout('$("#btnProductosXBodega").removeAttr("disabled")',1e3),(productobodega=new ProductoBodega).ClearCtls(),productobodega.Read,productobodega.LimpiaLista()})}SaveCantidad(idProductoTemporal){var miAccion=null==this.id?"Create":"Update";$.ajax({type:"POST",url:"class/ProductosXBodega.php",data:{action:miAccion,obj:JSON.stringify(this),idProductoTemporal:idProductoTemporal}}).done(productobodega.showInfo).fail(function(e){productobodega.showError(e)}).always(function(){setTimeout('$("#btnProductosXBodega").removeAttr("disabled")',1e3),(productobodega=new ProductoBodega).ClearCtls(),productobodega.Read})}get UpdateValue(){$("#btnCantidadCosto").attr("disabled","disabled");var miAccion="Update";this.cantidad=$("#cantidad").val(),this.costo=$("#costo").val(),$.ajax({type:"POST",url:"class/ProductosXBodega.php",data:{action:"Update",obj:JSON.stringify(this)}}).done(productobodega.showInfo).fail(function(e){productobodega.showError(e)}).always(function(){setTimeout('$("#btnCantidadCosto").removeAttr("disabled")',1e3),(productobodega=new ProductoBodega).ClearCtls(),productobodega.Read})}get Delete(){$.ajax({type:"POST",url:"class/ProductosXBodega.php",data:{action:"Delete",id:this.id}}).done(function(){swal({type:"success",title:"Eliminado!",showConfirmButton:!1,timer:1e3})}).fail(function(e){productobodega.showError(e)}).always(function(){(productobodega=new ProductoBodega).Read})}Reload(e){null==this.id?this.ShowAll(e):this.ShowItemData(e)}showInfo(){$(".close").click(),swal({type:"success",title:"Listo!",showConfirmButton:!1,timer:1e3})}showError(e){var data=JSON.parse(e.responseText);swal({type:"error",title:"Oops...",text:"Algo no está bien ("+data.code+"): "+data.msg,footer:"<a href>Contacte a Soporte Técnico</a>"})}LimpiaLista(){$("#tableBody-listaProducto").html(""),$("#nombre").val(""),$("#descripcion").val(""),$("#tipo").val("")}ClearCtls(){$("#producto").val(""),$("#cantidad").val(""),$("#costo").val("")}ShowAll(e){var t=$("#tDeterminacion").DataTable();t.clear();var data=JSON.parse(e);t.rows.add(data),t.draw()}AddProductoEventHandler(){var posicion=null;if(productobodega.id=$(this).parents("tr").find("td:eq(1)").html(),productobodega.idProducto=$(this).parents("tr").find("td:eq(2)").html(),productobodega.producto=$(this).parents("tr").find("td:eq(3)").html(),productobodega.cantidad=$(this).parents("tr").find("td:eq(4)").html(),productobodega.costo=$(this).parents("tr").find("td:eq(5)").html(),$(this).is(":checked")){if(-1!=productobodega.lista.indexOf(productobodega.id))return $(this).attr("checked",!1),!1;productobodega.AddTableProducto(productobodega.id,productobodega.producto)}else posicion=productobodega.lista.indexOf(productobodega.id),productobodega.lista.splice(posicion,1),$("#row"+productobodega.id).remove()}AddTableProducto(){if($("#tableBody-listaProducto").append(`\n            <tr id="row"${productobodega.id}> \n                <td class="itemId" >${productobodega.id}</td>\n                <td class="itemId" >${productobodega.idProducto}</td>\n                <td>${productobodega.producto}</td>\n                <td>\n                    <input id="cantidad" class="form-control col-3" name="cantidad" type="number" placeholder="Cantidad de artículos" autofocus="" data-validate-minmax="1,${productobodega.cantidad}" value="1">\n                </td>\n                <td>\n                    <input id="costo" class="form-control col-3" name="costo" readonly type="text" placeholder="Costo del artículo" autofocus="" value="${productobodega.costo}">\n                </td>\n                <td class=" last">\n                    <a id ="delete_row${productobodega.id}" onclick="elaborarProducto.DeleteInsumo(this)" > <i class="glyphicon glyphicon-trash" onclick="DeleteInsumo(this)"> </i> Eliminar </a>\n                </td>\n            </tr>\n        `),$.fn.dataTable.isDataTable("#dsArticulo"))var table=$("#dsArticulo").DataTable();else $("#dsArticulo").DataTable({columns:[{width:"40%"},{width:"25%"},{width:"25%"},{width:"10%"}],paging:!0,search:!0})}AddEventHandler(){$("#editarnombreproducto").text($("#productonombre").val()),$("#costoproductoagregar").val($("#costo").val())}UpdateEventHandler(){productobodega.id=$(this).parents("tr").find(".itemId").text()||$(this).find(".itemId").text(),productobodega.Read}ShowItemData(e){this.ClearCtls();var data=JSON.parse(e)[0];productobodega=new ProductoBodega(data.id,data.idBodega,data.idProducto,data.producto,data.cantidad,data.costo),$("#productonombre").val(productobodega.producto),$("#cantidad").val(productobodega.cantidad),$("#costo").val(productobodega.costo),$("#myModalLabel").html("<h1>"+usuario.nombre+"<h1>")}DeleteEventHandler(){productobodega.id=$(this).parents("tr").find(".itemId").text(),swal({title:"Eliminar?",text:"Esta acción es irreversible!",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",confirmButtonClass:"btn btn-success",cancelButtonClass:"btn btn-danger"}).then(result=>{result.value&&productobodega.Delete})}setTable(buttons=!0){$("#tDeterminacion").DataTable({responsive:!0,info:!1,language:{infoEmpty:"Sin Productos Ingresados",emptyTable:"Sin Productos Ingresados",search:"Buscar",zeroRecords:"No hay resultados",lengthMenu:"Mostrar _MENU_ registros",paginate:{first:"Primera",last:"Ultima",next:"Siguiente",previous:"Anterior"}},columns:[{title:"ID",data:"id",className:"itemId",searchable:!1},{title:"TAMAÑO",data:null,render:function(data,type,row){var fdata="";return fdata="1"===row.tamano?"Grande":"Mediano"}},{title:"PRECIO VENTA",mRender:function(data,row){return'<input class="cantidad form-control" type="number" min="1" max="9999999999" step="1" style="text-align:right;" precioVenta='+data+"  value= "+parseFloat(data).toFixed(2)+" >"},data:"precioVenta"},{title:"ACCION",orderable:!1,searchable:!1,visible:buttons,className:"buttons",mRender:function(){return'<a class="update" > <i class="glyphicon glyphicon-edit" > </i> Editar </a> | <a class="delete"> <i class="glyphicon glyphicon-trash"> </i> Eliminar </a>'}}]})}ActualizarPrecios(){productobodega.lista=[],$("#tDeterminacion tbody tr").each(function(i,item){var objlista=new Object;objlista.id=$(item).find("td:eq(0)")[0].textContent,objlista.precioVenta=$(this).find("td:eq(2) input").val(),productobodega.lista.push(objlista)}),$.ajax({type:"POST",url:"class/ProductosXBodega.php",data:{action:"ActualizaPrecios",obj:JSON.stringify(this)}}).done(producto.showInfo).fail(function(e){producto.showError(e)}).always(function(){setTimeout('$("#btnSubmit").removeAttr("disabled")',1e3),producto=new Producto,$("#p_searh").focus()})}Init(){var validator=new FormValidator({events:["blur","input","change"]},document.forms.frmProductosXBodega);$("#frmProductosXBodega").submit(function(e){var validatorResult;return e.preventDefault(),validator.checkAll(this).valid&&productobodega.Save,!1}),$("#frmProductosXBodega").length>0&&(document.forms.frmProductosXBodega.onreset=function(e){validator.reset()});var validator=new FormValidator({events:["blur","input","change"]},document.forms.frmCantidadCostoxProducto);$("#frmCantidadCostoxProducto").submit(function(e){var validatorResult;return e.preventDefault(),validator.checkAll(this).valid&&productobodega.Save,!1}),$("#frmCantidadCostoxProducto").length>0&&(document.forms.frmCantidadCostoxProducto.onreset=function(e){validator.reset()})}}let productobodega=new ProductoBodega;