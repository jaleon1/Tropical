class Usuario{constructor(id,nombre,username,password,email,activo,r,b){this.id=id||null,this.nombre=nombre||"",this.username=username||"",this.password=password||"",this.email=email||"",this.activo=activo||0,this.listarol=r||null,this.bodegas=b||null}get tUpdate(){return this.update="update"}get tSelect(){return this.select="select"}set viewEventHandler(_t){this.viewType=_t}get Read(){var miAccion=null==this.id?"ReadAll":"Read";"ReadAll"==miAccion&&0==$("#tUsuario tbody").length||$.ajax({type:"POST",url:"class/Usuario.php",data:{action:miAccion,id:this.id}}).done(function(e){usuario.Reload(e)}).fail(function(e){usuario.showError(e)}).always()}get Save(){NProgress.start(),$("#btnUsuario").attr("disabled","disabled");var miAccion=null==this.id?"Create":"Update";this.nombre=$("#nombre").val(),this.username=$("#username").val(),this.password==$("#password").val()?this.password="NOCHANGED":this.password=$("#password").val(),this.email=$("#email").val(),this.activo=$("#activo")[0].checked,this.listarol=$("#rol > option:selected").map(function(){return this.value}).get(),this.bodegas=$("#selbodega option:selected").map(function(){return this.value}).get(),$.ajax({type:"POST",url:"class/Usuario.php",data:{action:miAccion,obj:JSON.stringify(this)}}).done(usuario.showInfo).fail(function(e){usuario.showError(e)}).always(function(){setTimeout('$("#btnUsuario").removeAttr("disabled")',1e3),(usuario=new Usuario).ClearCtls(),usuario.Read,$("#nombre").focus(),NProgress.done()})}get Delete(){$.ajax({type:"POST",url:"class/Usuario.php",data:{action:"Delete",id:this.id}}).done(function(e){var data=JSON.parse(e);0==data.status?swal({type:"success",title:"Eliminado!",showConfirmButton:!1,timer:1e3}):1==data.status?swal({type:"error",title:"No es posible eliminar...",text:"El registro que intenta eliminar tiene objetos relacionados"}):swal({type:"error",title:"Ha ocurrido un error...",text:"El registro no ha sido eliminado",footer:"<a href>Contacte a Soporte Técnico</a>"})}).fail(function(e){usuario.showError(e)}).always(function(){(usuario=new Usuario).Read})}Reload(e){null==this.id?this.ShowAll(e):this.ShowItemData(e)}showInfo(){$(".close").click(),swal({type:"success",title:"Listo!",showConfirmButton:!1,timer:1e3})}showError(e){var data=JSON.parse(e.responseText);swal({type:"error",title:"Oops...",text:"Algo no está bien ("+data.code+"): "+data.msg,footer:"<a href>Contacte a Soporte Técnico</a>"})}ClearCtls(){$("#id").val(""),$("#nombre").val(""),$("#username").val(""),$("#password").val(""),$("#repetir").val(""),$("#email").val(""),$("#activo").length>0&&($("#activo")[0].checked=!0),$("#rol option").prop("selected",!1),$("#rol").length>0&&$("#rol").selectpicker("refresh"),$("#selbodega option").prop("selected",!1),$("#selbodega").length>0&&$("#selbodega").selectpicker("refresh"),$("#checkusername").removeClass("fa-check-circle"),$("#checkusername").removeClass("fa-times-circle"),$("#checkusername").text("")}ShowAll(e){var t=$("#tUsuario").DataTable();0==t.rows().count()?(t.clear(),t.rows.add(JSON.parse(e)),t.draw(),$(document).on("click",".delete",usuario.DeleteEventHandler),$(document).on("click","#tUsuario tbody tr td:not(.buttons)",null==usuario.viewType||usuario.viewType==usuario.tUpdate?usuario.UpdateEventHandler:usuario.SelectEventHandler)):(t.clear(),t.rows.add(JSON.parse(e)),t.draw())}UpdateEventHandler(){usuario.id=$(this).parents("tr").find(".itemId").text()||$(this).find(".itemId").text(),usuario.Read}SelectEventHandler(){(usuario=new Usuario).id=$(this).parents("tr").find(".itemId").text()||$(this).find(".itemId").text(),usuario.nombre=$(this).parents("tr").find("td:eq(1)").text()||$(this).find("td:eq(1)").text(),usuario.username=$(this).parents("tr").find("td:eq(2)").text()||$(this).find("td:eq(2)").text(),usuario.email=$(this).parents("tr").find("td:eq(3)").text()||$(this).find("td:eq(3)").text(),$("#nombre").val(usuario.nombre),$("#username").val(usuario.descripcion),$("#email").val(usuario.tipo),$("#modalUsuario").modal("toggle")}ShowItemData(e){this.ClearCtls();var data=JSON.parse(e);usuario=new Usuario(data.id,data.nombre,data.username,data.password,data.email,data.activo,data.listarol,data.bodegas),$("#id").val(usuario.id),$("#nombre").val(usuario.nombre),$("#username").val(usuario.username),$("#myModalLabel").html("<h1>"+usuario.username+"<h1>"),$("#password").val(usuario.password),$("#repetir").val(usuario.password),1==usuario.activo?$("#activo")[0].checked=!0:$("#activo")[0].checked=!1,$("#email").val(usuario.email),$.each(usuario.listarol,function(i,item){$("#rol option[value="+item.id+"]").prop("selected",!0)}),$("#rol").selectpicker("refresh"),$.each(usuario.bodegas,function(i,item){$("#selbodega option[value="+item.idBodega+"]").prop("selected",!0)}),$("#selbodega").selectpicker("refresh"),$(".modal").modal("toggle")}DeleteEventHandler(){usuario.id=$(this).parents("tr").find(".itemId").text(),swal({title:"Eliminar?",text:"Esta acción es irreversible!",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",confirmButtonClass:"btn btn-success",cancelButtonClass:"btn btn-danger"}).then(result=>{result.value&&usuario.Delete})}CheckUsername(){if(""!=$("#username").val()){$("#btnUsuario").attr("disabled","disabled");var miAccion="CheckUsername";this.username=$("#username").val(),$.ajax({type:"POST",url:"class/Usuario.php",data:{action:miAccion,username:this.username}}).done(function(e){var data;0==JSON.parse(e).status?($("#checkusername").removeClass("fa-times-circle"),$("#checkusername").addClass("fa-check-circle"),$("#btnUsuario").removeAttr("disabled"),$("#checkusername").text(" Nombre de usuario único.")):($("#checkusername").removeClass("fa-check-circle"),$("#checkusername").addClass("fa-times-circle"),$("#checkusername").text(" Nombre de usuario repetido."))}).fail(function(e){usuario.showError(e)})}}Init(){var validator=new FormValidator({events:["blur","input","change"]},document.forms[0]);$("#frmUsuario").submit(function(e){var validatorResult;return e.preventDefault(),validator.checkAll(this).valid&&usuario.Save,!1}),document.forms[0].onreset=function(e){validator.reset()},$("#username").focusout(function(){usuario.CheckUsername()}),$("#username").on("keyup",function(event){this.value=this.value.replace(/\s+/g,"").toLowerCase()})}setTable(buttons=!0){$("#tUsuario").DataTable({responsive:!0,info:!1,destroy:!0,order:[[1,"asc"]],language:{infoEmpty:"Sin Usuarios Registrados",emptyTable:"Sin Usuarios Registrados",search:"Buscar",zeroRecords:"No hay resultados",lengthMenu:"Mostrar _MENU_ registros",paginate:{first:"Primera",last:"Ultima",next:"Siguiente",previous:"Anterior"}},columns:[{title:"ID",data:"id",className:"itemId",searchable:!1},{title:"NOMBRE",data:"nombre"},{title:"USUARIO",data:"username"},{title:"CORREO",data:"email"},{title:"ACTIVO",data:"activo"},{title:"ELIMINAR",orderable:!1,searchable:!1,visible:buttons,className:"buttons",width:"5%",mRender:function(){return'<a class="delete" style="cursor: pointer;" > <i class="glyphicon glyphicon-trash"> </i> </a>'}}]})}}let usuario=new Usuario;