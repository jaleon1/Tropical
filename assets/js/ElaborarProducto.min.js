class ElaborarProducto{constructor(numeroOrden,p,idOrdenSalida){this.numeroOrden=numeroOrden||"",this.fechaLiquida=this.fechaLiquida||"",this.listaProducto=p||[],this.idOrdenSalida=idOrdenSalida}get Save(){if(0!=$("#tableBody-ProductoGenerado tr").length)if(0!=$("#tableBody-InsumosOrdenSalida tr").length){$("#btnAddProductoGenerado").attr("disabled","disabled"),$("#btnSaveProductoGenerado").attr("disabled","disabled");var miAccion=null==this.id?"Create":"Update";elaborarProducto.numeroOrden=$("#orden").val(),elaborarProducto.idOrdenSalida=ordenSalida.id,elaborarProducto.fechaLiquida=moment().format("YYYY-MM-DD HH:mm:ss"),elaborarProducto.listaProducto=[];var costoTotalInsumo=0;$("#tableBody-InsumosOrdenSalida tr").each(function(){costoTotalInsumo+=parseFloat($(this).find("td:eq(6)").html())*parseFloat($(this).find("td:eq(7) input").val())}),$("#tableBody-ProductoGenerado tr").each(function(){var objProducto=new Object;objProducto.idProducto=$(this).find("td:eq(0)").html(),objProducto.cantidad=$(this).find("td:eq(10) input").val(),objProducto.costo=costoTotalInsumo,elaborarProducto.listaProducto.push(objProducto)}),$.ajax({type:"POST",url:"class/ElaborarProducto.php",data:{action:miAccion,obj:JSON.stringify(this)}}).done(function(e){$("#btnAddProductoGenerado").attr("disabled",!1),$("#btnSaveProductoGenerado").attr("disabled",!1),swal({type:"success",title:"Número de Orden:"+$("#orden").val(),text:"Liquidada:",showConfirmButton:!0})}).fail(function(e){elaborarProducto.showError(e)}).always(function(){$("#btnProductoTemporal").removeAttr("disabled"),elaborarProducto.ClearCtls()})}else swal({type:"info",title:"Debe de ingresar una orden..."});else swal({type:"info",title:"Debe agregar los Productos a generar..."})}get Delete(){$.ajax({type:"POST",url:"class/ElaborarProducto.php",data:{action:"Delete",id:this.id}}).done(function(){var data=JSON.parse(e);0==data.status?swal({type:"success",title:"Eliminado!",showConfirmButton:!1,timer:1e3}):1==data.status?swal({type:"error",title:"No es posible eliminar...",text:"El registro que intenta eliminar tiene objetos relacionados"}):swal({type:"error",title:"Ha ocurrido un error...",text:"El registro no ha sido eliminado",footer:"<a href>Contacte a Soporte Técnico</a>"})}).fail(function(e){elaborarProducto.showError(e)}).always(function(){(elaborarProducto=new ElaborarProducto).Read})}AddOrdenSalida(){ordenSalida.id=$(this).parents("tr").find(".itemId").text(),$("#numeroOrden").val($(this).parents("tr").find("td:eq(1)").html())}Reload(e){null==this.id?this.ShowAll(e):this.ShowItemData(e)}showInfo(){swal({type:"success",title:"Listo!",showConfirmButton:!1,timer:1e3})}showError(e){var data=JSON.parse(e.responseText);swal({type:"error",title:"Oops...",text:"Algo no está bien ("+data.code+"): "+data.msg,footer:"<a href>Contacte a Soporte Técnico</a>"})}ClearCtls(){$("#orden").val(""),$("#fecha").val(""),$("#usuarioEntrega").val(""),$("#usuarioRecibe").val(""),$("#p_searh").val(""),$("#tableBody-ProductoGenerado").html(""),$("#tableBody-InsumosOrdenSalida").html("")}ShowAll(e){if(-1!=url.indexOf("ElaborarProducto.html")){$("#tableBody-ElaborarProducto").html("");var data=JSON.parse(e),saldoCosto="EN PROCESO";if($.each(data,function(i,item){saldoCosto="0"==item.saldoCosto?"EN PROCESO":"TERMINADO",$("#tableBody-ElaborarProducto").append(`\n                    <tr> \n                        <td class="a-center ">\n                            <input id="chkaddorden${item.id}" type="checkbox" class="flat" name="table_records">\n                        </td>\n                        <td class="itemId">${item.id}</td>\n                        <td class="oculto">${item.codigo}</td>\n                        <td class="oculto">${item.txtColor}</td>\n                        <td class="oculto">${item.bgColor}</td>\n                        <td>${item.nombre}</td>\n                        <td>${item.nombreAbreviado}</td>\n                        <td>${item.descripcion}</td>\n                        <td>${item.saldoCantidad}</td>\n                        <td>${saldoCosto}</td>\n                    </tr>\n                `),$("#chkaddorden"+item.id).click(elaborarProducto.UpdateCantidadProducto)}),$.fn.dataTable.isDataTable("#dsProductoTemporal"))var table=$("#dsProductoTemporal").DataTable();else $("#dsProductoTemporal").DataTable()}$("#tableBody-ElaborarProducto").html("");var data=JSON.parse(e),saldoCosto="EN PROCESO";if($.each(data,function(i,item){saldoCosto="0"==item.saldoCosto?"EN PROCESO":"TERMINADO",$("#tableBody-ElaborarProducto").append(`\n                <tr> \n                    <td class="itemId">${item.id}</td>\n                    <td class="oculto">${item.codigo}</td>\n                    <td class="oculto">${item.txtColor}</td>\n                    <td class="oculto">${item.bgColor}</td>\n                    <td>${item.nombre}</td>\n                    <td>${item.nombreAbreviado}</td>\n                    <td>${item.descripcion}</td>\n                    <td>${item.saldoCantidad}</td>\n                    <td>${saldoCosto}</td>\n                    <td class=" last">\n                        <a id="update${item.id}" class="update" data-toggle="modal" data-target=".bs-example-modal-lg" > <i class="glyphicon glyphicon-edit" > </i> Editar </a> | \n                        <a id="delete${item.id}" class="delete"> <i class="glyphicon glyphicon-trash"> </i> Eliminar </a>\n                    </td>\n                    <td class="a-center ">\n                    <input id="chkterminado${item.id}" type="checkbox" class="flat" name="table_records">\n                    </td>\n                </tr>\n            `),$("#update"+item.id).click(elaborarProducto.UpdateEventHandler),$("#delete"+item.id).click(elaborarProducto.DeleteEventHandler),$("#chkterminado"+item.id).click(elaborarProducto.UpdateCantidadProducto)}),$.fn.dataTable.isDataTable("#dsProductoTemporal"))var table=$("#dsProductoTemporal").DataTable();else $("#dsProductoTemporal").DataTable()}AddTableProducto(id,codigo,nombre,nombreAbreviado,descripcion,saldoCantidad,saldoCosto,costoPromedio,precioVenta,esVenta){if($("#tableBody-ProductoGenerado").append(`\n            <tr id="row"${id}> \n                <td class="itemId" >${id}</td>\n                <td class=oculto>${codigo}</td>\n                <td>${nombre}</td>\n                <td class=oculto>${nombreAbreviado}</td>\n                <td class=oculto>${descripcion}</td>\n                <td class=oculto>${saldoCantidad}</td>\n                <td class=oculto>${saldoCosto}</td>\n                <td class=oculto>${costoPromedio}</td>\n                <td class=oculto>${precioVenta}</td>\n                <td class=oculto>${esVenta}</td>\n                <td>\n                    <input id="cantidadProducto" class="form-control col-3" name="cantidadProducto" type="text" placeholder="Cantidad de paquetes" autofocus="" value="1">\n                </td>\n                <td class=" last">\n                    <a id ="delete_row${id}" onclick="elaborarProducto.DeleteInsumo(this)" > <i class="glyphicon glyphicon-trash" onclick="DeleteInsumo(this)"> </i> Eliminar </a>\n                </td>\n            </tr>\n        `),$.fn.dataTable.isDataTable("#dsProductoGenerado"))var table=$("#dsProductoGenerado").DataTable();else $("#dsProductoGenerado").DataTable({columns:[{width:"0%"},{width:"0%"},{width:"33%"},{width:"0%"},{width:"0%"},{width:"0%"},{width:"0%"},{width:"0%"},{width:"0%"},{width:"0%"},{width:"35%"},{width:"30%"}],paging:!1,ordering:!1,info:!1,searching:!1})}DeleteInsumo(btn){var row=btn.parentNode.parentNode;row.parentNode.removeChild(row)}UpdateEventHandler(){elaborarProducto.id=$(this).parents("tr").find(".itemId").text(),elaborarProducto.Read}ShowItemData(e){this.ClearCtls();var data=JSON.parse(e);elaborarProducto=new ElaborarProducto(data.id,data.codigo,data.nombre,data.txtColor,data.bgColor,data.nombreAbreviado,data.descripcion,data.saldoCantidad,data.saldoCosto,data.listaProducto),$.each(data.listaProducto,function(i,item){if($("#tableBody-InsumoProducto").append(`\n                <tr id="row"${item.idInsumo}> \n                    <td class="itemId" >${item.idInsumo}</td>\n                    <td>${item.nombre}</td>\n                    <td>\n                        <input id="cantidadInsumo" class="form-control col-3" name="cantidadInsumo" type="text" placeholder="${item.saldoCantidad}" autofocus="" value="1">\n                    </td>\n                    <td class=" last">\n                        <a id ="delete_row${item.id}" onclick="elaborarProducto.DeleteInsumo(this)" > <i class="glyphicon glyphicon-trash" onclick="DeleteInsumo(this)"> </i> Eliminar </a>\n                    </td>\n                </tr>\n            `),$.fn.dataTable.isDataTable("#dsProductoTemporal"))var table=$("#dsProductoTemporal").DataTable();else $("#dsProductoTemporal").DataTable({columns:[{width:"35%"},{width:"35%"},{width:"33%"}],paging:!0,search:!0})}),$("#nombre").val(elaborarProducto.nombre),$("#saldoCantidad").val(elaborarProducto.saldoCantidad),$("#descripcion").val(elaborarProducto.descripcion)}DeleteEventHandler(){elaborarProducto.id=$(this).parents("tr").find(".itemId").text(),swal({title:"Eliminar?",text:"Esta acción es irreversible!",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",confirmButtonClass:"btn btn-success",cancelButtonClass:"btn btn-danger"}).then(result=>{result.value&&elaborarProducto.Delete})}AddUserEventHandler(){$("#descripcion").val($(this).parents("tr").find("td:eq(2)").html()),elaborarProducto.bgColor=$(this).parents("tr").find("td:eq(1)").html(),$("#modal-descripcion").modal("toggle"),$("#saldoCantidad").focus()}AddProductoEventHandler(id,codigo,nombre,nombreAbreviado,descripcion,saldoCantidad,saldoCosto,costoPromedio,precioVenta,esVenta){var ids_productos=[];$("#tableBody-ProductoGenerado tr").each(function(){ids_productos.push($(this).find("td:eq(0)").html())}),0==ids_productos.length?elaborarProducto.AddTableProducto(id,codigo,nombre,nombreAbreviado,descripcion,saldoCantidad,saldoCosto,costoPromedio,precioVenta,esVenta):-1!=ids_productos.indexOf(id)?$("#chk-addproducto"+id).attr("checked",!1):elaborarProducto.AddTableProducto(id,codigo,nombre,nombreAbreviado,descripcion,saldoCantidad,saldoCosto,costoPromedio,precioVenta,esVenta)}Init(){var validator=new FormValidator({events:["blur","input","change"]},document.forms[0][0]);$("#frmProductoGenerado").submit(function(e){var validatorResult;return e.preventDefault(),validator.checkAll(this).valid&&elaborarProducto.Save,!1}),$("#frmProductoTemporal").submit(function(e){var validatorResult;return e.preventDefault(),validator.checkAll(this).valid&&elaborarProducto.Save,!1}),document.forms[0].onreset=function(e){validator.reset()}}}let elaborarProducto=new ElaborarProducto;