class DistribucionCancelada{constructor(facturas,tb_distribucionCanceladas,factDetalle,tb_prdXFact,fechaInicial,fechaFinal){this.facturas=facturas||new Array,this.factDetalle=factDetalle||new Array,this.tb_distribucionCanceladas=tb_distribucionCanceladas||null,this.fechaInicial=fechaInicial||"",this.fechaFinal=fechaFinal||""}CargaDistribuciones(){$.ajax({beforeSend:function(){$("body").addClass("loading")},type:"POST",url:"class/Distribucion.php",data:{action:"ReadCancelada",obj:JSON.stringify(distribucionCancelada)},complete:function(){$("body").removeClass("loading")}}).done(function(e){distribucionCancelada.drawFac(e)})}setTableVista(buttons=!0){$("#tDistribucion").DataTable({responsive:!0,destroy:!0,order:[[1,"desc"]],dom:"Bfrtip",buttons:[{extend:"excelHtml5",exportOptions:{columns:[1,2,3,4,5,6]},messageTop:"Traslados y facturación"},{extend:"pdfHtml5",messageTop:"Traslados y facturación",exportOptions:{columns:[1,2,3,4,5,6]}}],language:{infoEmpty:"Sin Traslados Registrados",emptyTable:"Sin Traslados Registrados",search:"Buscar",zeroRecords:"No hay resultados",lengthMenu:"Mostrar _MENU_ registros",paginate:{first:"Primera",last:"Ultima",next:"Siguiente",previous:"Anterior"}},columns:[{title:"ID",data:"id",className:"itemId",searchable:!1},{title:"FECHA",data:"fecha"},{title:"ORDEN",data:"orden"},{title:"USUARIO",data:"userName"},{title:"BODEGA",data:"bodega"},{title:"TOTAL",data:"total",className:"text-right",mRender:function(e){return"¢"+parseFloat(e).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,".")}},{title:"ESTADO",data:"idEstadoComprobante",render:function(data,type,row,meta){if("Interna"==row.tipoBodega)return'<i class="fa fa-check-square-o" aria-hidden="true" style="color:green"> Aceptado</i>';switch(data){case"1":return'<i class="fa fa-paper-plane" aria-hidden="true" style="color:red"> Sin Enviar</i>';case"2":return'<i class="fa fa-paper-plane" aria-hidden="true" style="color:green"> Enviado</i>';case"3":return'<i class="fa fa-check-square-o" aria-hidden="true" style="color:green"> Aceptado</i>';case"4":return'<i class="fa fa-times-circle" aria-hidden="true" style="color:red"> Rechazado</i>';case"5":return'<i class="fa fa-exclamation-triangle" aria-hidden="true" style="color:#FF6F00"> Otro</i>';case"99":return'<i class="fa fa-exclamation-triangle" aria-hidden="true" style="color:green"> Reportado</i>';default:return"Desconocido"}}},{title:"TIPO BODEGA",data:"tipoBodega"},{title:"ACCION",className:"buttons",data:"claveNC",render:function(data,type,row,meta){if("Interna"==row.tipoBodega)return"<button class=btnCancelaFactura>Cancelar Factura</button>";if(null!=data)return'<i class="fa fa-check-square-o" aria-hidden="true" style="color:green">Factura Cancelada!</i>';switch(row.idEstadoComprobante){case"1":return"<button class=btnEnviarFactura>Enviar</button>";case"2":return"<button class=btnConsultafactura>Consultar</button>";case"3":case"4":return"<button class=btnCancelaFactura>Cancelar Factura</button>";case"5":return"<button class=btnReenviarFactura>Reenviar</button><button class=btnSoporte>Soporte</button>";default:return"<button>Soporte</button>"}}}]})}CargaDistribucionesXUsuario(){$.ajax({type:"POST",url:"class/Factura.php",data:{action:"ReadCanceladaUsuario"}}).done(function(e){"NOCONTRIB"==JSON.parse(e).msg?swal({type:"warning",title:"Contribuyente",text:"Contribuyente no registrado para Facturación Electrónica",footer:'<a href="clienteFE.html">Agregar Contribuyente</a>'}).then(result=>{result.value&&(location.href="Dashboard.html")}):distribucionCancelada.drawFac(e)})}drawFac(e){var facturas=JSON.parse(e);this.tb_distribucionCanceladas=$("#tb_distribucionCanceladas").DataTable({responsive:!0,destroy:!0,dom:"Bfrtip",buttons:[{extend:"excelHtml5",footer:!0,exportOptions:{columns:[1,2,3,4,5,6]},messageTop:"Lista de facturas Canceladas"},{extend:"pdfHtml5",footer:!0,messageTop:"Lista de facturas Canceladas",exportOptions:{columns:[1,2,3,4,5,6]}}],language:{infoEmpty:"Sin Distribuciones Canceladas",emptyTable:"Sin Distribuciones Canceladas",search:"Buscar",zeroRecords:"No hay resultados",lengthMenu:"Mostrar _MENU_ registros",paginate:{first:"Primera",last:"Ultima",next:"Siguiente",previous:"Anterior"}},data:facturas,order:[[1,"desc"]],columns:[{title:"ID",data:"id",className:"itemId",searchable:!1},{title:"FECHA",data:"fecha"},{title:"ORDEN",data:"orden"},{title:"USUARIO",data:"userName"},{title:"BODEGA",data:"bodega"},{title:"TOTAL",data:"total",className:"text-right",mRender:function(e){return"¢"+parseFloat(e).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,".")}},{title:"TIPO BODEGA",data:"tipoBodega"},{title:"ESTADO",data:"idEstadoComprobante",render:function(data,type,row,meta){if("Interna"==row.tipoBodega)return'<i class="fa fa-check-square-o" aria-hidden="true" style="color:green"> Aceptado</i>';switch(data){case"1":return'<i class="fa fa-paper-plane" aria-hidden="true" style="color:red"> Sin Enviar</i>';case"2":return'<i class="fa fa-paper-plane" aria-hidden="true" style="color:green"> Enviado</i>';case"3":return'<i class="fa fa-check-square-o" aria-hidden="true" style="color:green"> Aceptado</i>';case"4":return'<i class="fa fa-times-circle" aria-hidden="true" style="color:red"> Rechazado</i>';case"5":return'<i class="fa fa-exclamation-triangle" aria-hidden="true" style="color:#FF6F00"> Otro</i>';case"99":return'<i class="fa fa-exclamation-triangle" aria-hidden="true" style="color:green"> Reportado</i>';default:return"Desconocido"}}},{title:"ACCION",className:"buttons",data:"claveNC",render:function(data,type,row,meta){if(null!=data)return'<i class="fa fa-check-square-o" aria-hidden="true" style="color:green">&nbsp Factura Cancelada!</i>';switch(row.idEstadoComprobante){case"1":return"<button class=btnEnviarFactura>&nbsp Enviar</button>";case"2":return'<i class="fa fa-check-square-o">&nbsp Enviada</i>';case"3":return"<button class=btnCancelaFactura>&nbsp Cancelar Factura</button>";case"4":return"<button class=btnNC_CreateFact_Ref>&nbsp Cancelar & Reenviar</button>";case"5":return'<i class="fa fa-cloud-upload" aria-hidden="true">&nbsp Enviar Contingencia</i>';default:return"<button>Soporte</button>"}}}]})}ReadbyID(id){$("#detalleFac").empty();var detalleFac=`<button type="button" class="close" data-dismiss="modal">\n                <span aria-hidden="true">x</span>\n            </button>\n            <h4 class="modal-title">Factura #</h4>\n            <h4 class="modal-title" id="consecutivo">${id.consecutivo}.</h4>\n            <div class="row">\n                <div class="col-md-6 col-sm-6 col-xs-6">\n                    <label>Fecha:</label>\n                    <label id='fecha'>${id.fechaCreacion}</label>\n                </div>\n            </div>\n            <div class="row">\n                <div class="col-md-6 col-sm-6 col-xs-6">\n                    <label>Cajero:</label>\n                    <label id='cajero'>${id.vendedor}</label>\n                </div>\n                <div class="col-md-6 col-sm-6 col-xs-6">\n                    <label>Bodega:</label>\n                    <label id='bodega'>${id.bodega}</label>\n                </div>\n            </div>`;$("#detalleFac").append(detalleFac),$("#totalFact").empty(),$.ajax({type:"POST",url:"class/productoXFactura.php",data:{action:"ReadByIdFactura",id:id.id}}).done(function(e){distribucionCancelada.drawFactDetail(e)})}CargaListaDistribucionRango(){var referenciaCircular=distribucionCancelada.tb_distribucionCanceladas;distribucionCancelada.tb_distribucionCanceladas=[],$.ajax({type:"POST",url:"class/Distribucion.php",data:{action:"ReadCancelada",obj:JSON.stringify(distribucionCancelada)}}).done(function(e){distribucionCancelada.tb_distribucionCanceladas=referenciaCircular,distribucionCancelada.drawFac(e)})}CargaMisFacturasRango(){var referenciaCircular=distribucionCancelada.tb_distribucionCanceladas;distribucionCancelada.tb_distribucionCanceladas=[],$.ajax({type:"POST",url:"class/Factura.php",data:{action:"ReadAllbyRangeUser",obj:JSON.stringify(distribucionCancelada)}}).done(function(e){distribucionCancelada.tb_distribucionCanceladas=referenciaCircular,distribucionCancelada.drawFac(e)})}drawFactDetail(e){this.factDetalle=JSON.parse(e),this.tb_prdXFact=$("#tb_detalle_fact").DataTable({data:this.factDetalle,destroy:!0,searching:!1,paging:!1,info:!1,ordering:!1,order:[[0,"desc"]],columns:[{title:"PRODUCTO",data:"detalle"},{title:"CANTIDAD",data:"cantidad",type:"formatted-num",mRender:function(e){return parseFloat(e).toFixed(2)}},{title:"PRECIO",data:"montoTotalLinea",type:"formatted-num",mRender:function(e){return"¢"+parseFloat(e).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",")}}]}),$("#modalFac").modal("toggle")}ticketPrint(){localStorage.setItem("lsFactura",$("#consecutivo").text()),localStorage.setItem("lsFecha",moment().format("YYYY-MM-DD HH:mm")),localStorage.setItem("lsBodega",$("#bodega").text()),localStorage.setItem("lsUsuario",$("#cajero").text()),localStorage.setItem("lsListaProducto",JSON.stringify(this.factDetalle)),location.href="/TicketFacturacion.html"}}let distribucionCancelada=new DistribucionCancelada;$("#tb_distribucionCanceladas tbody").on("click","td",function(){if("Cancelar Factura"==this.textContent)return!1;distribucionCancelada.ReadbyID(distribucionCancelada.tb_distribucionCanceladas.row(this).data());var dtTable=$("#tb_distribucionCanceladas").DataTable(),efectivo=0,total=0;efectivo=parseFloat(dtTable.row(this).data()[8]),total=parseFloat(dtTable.row(this).data()[11]),null==dtTable.cells().data()[5]&&(efectivo=0),null==dtTable.cells().data()[6]&&(tarjeta=0),"0"==efectivo?(localStorage.setItem("lsVuelto","0"),localStorage.setItem("lsTarjetaCredito",String(total))):(localStorage.setItem("lsVuelto",String(efectivo-total)),localStorage.setItem("lsTarjetaCredito","0")),localStorage.setItem("lsEfectivo",String(efectivo)),localStorage.setItem("lsTotal",String(total)),localStorage.setItem("lsDif","0"),localStorage.setItem("lsReimpresion","OK")});