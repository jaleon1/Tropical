class InventarioFacturas{constructor(facturas,tb_facturas,factDetalle,tb_prdXFact,fechaInicial,fechaFinal){this.facturas=facturas||new Array,this.factDetalle=factDetalle||new Array,this.tb_facturas=tb_facturas||null,this.fechaInicial=fechaInicial||"",this.fechaFinal=fechaFinal||""}CargaFacturas(){$.ajax({type:"POST",url:"class/Factura.php",data:{action:"ReadAll"}}).done(function(e){inventarioFacturas.drawFac(e)})}CargaFacturasXUsuario(){$.ajax({type:"POST",url:"class/Factura.php",data:{action:"ReadAllById"}}).done(function(e){"NOCONTRIB"==JSON.parse(e).msg?swal({type:"warning",title:"Contribuyente",text:"Contribuyente no registrado para Facturación Electrónica",footer:'<a href="clienteFE.html">Agregar Contribuyente</a>'}).then(result=>{result.value&&(location.href="Dashboard.html")}):inventarioFacturas.drawFac(e)})}drawFac(e){var facturas=JSON.parse(e);this.tb_facturas=$("#tb_facturas").DataTable({responsive:!0,destroy:!0,order:[[1,"asc"]],dom:"Bfrtip",buttons:[{extend:"excelHtml5",exportOptions:{columns:[1,2,3,4,5,6]},messageTop:"Lista de facturas"},{extend:"pdfHtml5",exportOptions:{columns:[1,2,3,4,5,6]}}],language:{infoEmpty:"Sin Usuarios Registrados",emptyTable:"Sin Usuarios Registrados",search:"Buscar",zeroRecords:"No hay resultados",lengthMenu:"Mostrar _MENU_ registros",paginate:{first:"Primera",last:"Ultima",next:"Siguiente",previous:"Anterior"}},data:facturas,order:[[1,"desc"]],columns:[{title:"ID FACTURA",data:"id",visible:!1},{title:"#FACTURA",data:"consecutivo"},{title:"FECHA",data:"fechaCreacion"},{title:"ALMACEN",data:"nombre"},{title:"VENDEDOR",data:"userName"},{title:"ESTADO",data:"idEstadoComprobante"},{title:"MONTO EFECTIVO",data:"montoEfectivo",visible:!1,mRender:function(e){return null==e?"¢0":"¢"+parseFloat(e).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",")}},{title:"MONTO TARJETA",data:"montoTarjeta",visible:!1,mRender:function(e){return null==e?"¢0":"¢"+parseFloat(e).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",")}},{title:"TOTAL",data:"totalComprobante",mRender:function(e){return"¢"+parseFloat(e).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",")}},{title:"ESTADO COMPROBANTE",width:"5%",data:"idEstadoComprobante"}]})}ReadbyID(id){$("#detalleFac").empty();var detalleFac=`<button type="button" class="close" data-dismiss="modal">\n                <span aria-hidden="true">x</span>\n            </button>\n            <h4 class="modal-title">Factura #</h4>\n            <h4 class="modal-title" id="consecutivo">${id.consecutivo}.</h4>\n            <div class="row">\n                <div class="col-md-6 col-sm-6 col-xs-6">\n                    <label>Fecha:</label>\n                    <label id='fecha'>${id.fechaCreacion}</label>\n                </div>\n            </div>\n            <div class="row">\n                <div class="col-md-6 col-sm-6 col-xs-6">\n                    <label>Cajero:</label>\n                    <label id='cajero'>${id.userName}</label>\n                </div>\n                <div class="col-md-6 col-sm-6 col-xs-6">\n                    <label>Bodega:</label>\n                    <label id='bodega'>${id.nombre}</label>\n                </div>\n            </div>`;$("#detalleFac").append(detalleFac),$("#totalFact").empty(),$.ajax({type:"POST",url:"class/productoXFactura.php",data:{action:"ReadByIdFactura",id:id.id}}).done(function(e){inventarioFacturas.drawFactDetail(e)})}CargaListaFacturasRango(){$.ajax({type:"POST",url:"class/Factura.php",data:{action:"ReadAllbyRange",obj:JSON.stringify(inventarioFacturas)}}).done(function(e){inventarioFacturas.drawFac(e)})}drawFactDetail(e){this.factDetalle=JSON.parse(e),this.tb_prdXFact=$("#tb_detalle_fact").DataTable({data:this.factDetalle,destroy:!0,searching:!1,paging:!1,info:!1,ordering:!1,order:[[0,"desc"]],columns:[{title:"PRODUCTO",data:"detalle"},{title:"CANTIDAD",data:"cantidad",type:"formatted-num",mRender:function(e){return parseFloat(e).toFixed(2)}},{title:"PRECIO",data:"montoTotalLinea",type:"formatted-num",mRender:function(e){return"¢"+parseFloat(e).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",")}}]}),$("#modalFac").modal("toggle")}ticketPrint(){localStorage.setItem("lsFactura",$("#consecutivo").text()),localStorage.setItem("lsFecha",moment().format("YYYY-MM-DD HH:mm")),localStorage.setItem("lsBodega",$("#bodega").text()),localStorage.setItem("lsUsuario",$("#cajero").text()),localStorage.setItem("lsListaProducto",JSON.stringify(this.factDetalle)),location.href="/TicketFacturacion.html"}}let inventarioFacturas=new InventarioFacturas;$("#tb_facturas tbody").on("click","tr",function(){inventarioFacturas.ReadbyID(inventarioFacturas.tb_facturas.row(this).data());var dtTable=$("#tb_facturas").DataTable(),efectivo=0,total=0;efectivo=parseFloat(dtTable.row(this).data()[4]),total=parseFloat(dtTable.row(this).data()[3]),null==dtTable.cells().data()[5]&&(efectivo=0),null==dtTable.cells().data()[6]&&(tarjeta=0),"0"==efectivo?(localStorage.setItem("lsVuelto","0"),localStorage.setItem("lsTarjetaCredito",String(total))):(localStorage.setItem("lsVuelto",String(efectivo-total)),localStorage.setItem("lsTarjetaCredito","0")),localStorage.setItem("lsEfectivo",String(efectivo)),localStorage.setItem("lsTotal",String(total)),localStorage.setItem("lsDif","0"),localStorage.setItem("lsReimpresion","OK")});